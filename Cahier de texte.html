<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cahier de Texte Num√©rique</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .login-container {
      max-width: 400px;
      margin: 50px auto;
      padding: 30px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #2c3e50;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 5px;
      border-left: 4px solid #3498db;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], input[type="password"], input[type="date"], textarea, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background-color: #2980b9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #3498db;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      background: #ddd;
      cursor: pointer;
      border-radius: 5px 5px 0 0;
      margin-right: 5px;
    }
    .tab.active {
      background: #3498db;
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .student-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .student-item {
      display: flex;
      flex-direction: column;
      background: #eee;
      padding: 8px;
      border-radius: 4px;
    }
    .student-item .status-options {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    .student-item .student-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .student-item input {
      margin-right: 5px;
    }
    .search-box {
      margin-bottom: 15px;
    }
    .status-present {
      color: green;
    }
    .status-absent {
      color: red;
    }
    .status-late {
      color: orange;
    }
    .whatsapp-btn {
      background-color: #25D366;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .whatsapp-btn:hover {
      background-color: #128C7E;
    }
    .whatsapp-icon {
      width: 20px;
      height: 20px;
    }
    .logout-btn {
      background-color: #e74c3c;
      float: right;
    }
    .logout-btn:hover {
      background-color: #c0392b;
    }
    .hidden {
      display: none;
    }
    .error-message {
      color: #e74c3c;
      margin-bottom: 15px;
      text-align: center;
    }
    .gender-icon {
      font-size: 14px;
      margin-left: 5px;
    }
    .attendance-summary {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #2c3e50;
    }
    .summary-item {
      margin: 5px 0;
    }
    /* Styles pour la saisie intelligente */
    .autocomplete-container {
      position: relative;
      width: 100%;
    }
    .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover {
      background-color: #e9e9e9;
    }
    .autocomplete-active {
      background-color: #3498db !important;
      color: #ffffff;
    }
    .suggestion-chip {
      display: inline-block;
      background-color: #e0e0e0;
      padding: 4px 8px;
      margin: 4px;
      border-radius: 16px;
      font-size: 0.9em;
      cursor: pointer;
    }
    .suggestion-chip:hover {
      background-color: #d0d0d0;
    }
    .suggestions-container {
      margin-top: 5px;
      margin-bottom: 15px;
    }
    /* Styles pour l'√©diteur de texte enrichi */
    .rich-text-editor {
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .toolbar {
      background-color: #f5f5f5;
      border-bottom: 1px solid #ddd;
      padding: 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .toolbar button, .toolbar select {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 5px 8px;
      cursor: pointer;
      font-size: 14px;
    }
    .toolbar button:hover {
      background-color: #f0f0f0;
    }
    .toolbar select {
      height: 30px;
    }
    .editor-content {
      min-height: 100px;
      padding: 10px;
      resize: vertical;
      overflow-y: auto;
    }
    .editor-content:focus {
      outline: none;
    }
    .color-picker {
      width: 30px;
      height: 30px;
      padding: 0;
      border: 1px solid #ddd;
    }
    /* Styles pour la visualisation */
    .view-mode {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      border: 1px solid #ddd;
      margin-bottom: 15px;
    }
    .view-mode h3 {
      margin-top: 0;
      color: #2c3e50;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
    }
    .view-mode .content {
      margin: 10px 0;
    }
    .import-btn {
      background-color: #2ecc71;
    }
    .import-btn:hover {
      background-color: #27ae60;
    }
    .view-btn {
      background-color: #9b59b6;
    }
    .view-btn:hover {
      background-color: #8e44ad;
    }
    .export-btn {
      background-color: #f39c12;
    }
    .export-btn:hover {
      background-color: #e67e22;
    }
    .file-input {
      display: none;
    }
    .file-input-label {
      display: inline-block;
      padding: 10px 15px;
      background-color: #2ecc71;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    .file-input-label:hover {
      background-color: #27ae60;
    }
    .import-container {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #2ecc71;
    }
    /* Styles pour les champs de saisie enrichis */
    .rich-input {
      position: relative;
    }
    .rich-input-toolbar {
      background-color: #f5f5f5;
      border: 1px solid #ddd;
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      padding: 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .rich-input-content {
      min-height: 60px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 0 0 4px 4px;
      resize: vertical;
      overflow-y: auto;
    }
    .rich-input-content:focus {
      outline: none;
      border-color: #3498db;
    }
    .btn-retour {
      padding: 8px 16px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-bottom: 20px;
    }
    .btn-retour:hover {
      background-color: #e0e0e0;
    }
    /* Styles pour la modal d'aper√ßu */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 800px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      max-height: 80vh;
      overflow-y: auto;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
    }
  </style>
</head>
<body>
 

  <!-- √âcran de connexion -->
  <div id="loginScreen" class="login-container">
     <button class="btn-retour" onclick="history.back()">‚Üê Retour</button>
    <h1>Connexion Enseignants</h1>
    <div id="loginError" class="error-message hidden"></div>
    <label for="username">Nom d'utilisateur:</label>
    <input type="text" id="username" placeholder="Votre nom d'utilisateur">

    <label for="password">Mot de passe:</label>
    <input type="password" id="password" placeholder="Votre mot de passe">

    <button onclick="login()">Se connecter</button>
  </div>

  <!-- Application principale (cach√©e jusqu'√† l'authentification) -->
  <div id="appContainer" class="container hidden">
    <button class="logout-btn" onclick="logout()">D√©connexion</button>
    <h1>Cahier de Texte Num√©rique</h1>

    <div class="tabs">
      <div class="tab active" onclick="openTab('lesson')">Nouvelle Le√ßon</div>
      <div class="tab" onclick="openTab('attendance')">Pr√©sence</div>
      <div class="tab" onclick="openTab('view')">Voir les Entr√©es</div>
    </div>

    <!-- Nouvelle Le√ßon Tab -->
    <div id="lesson" class="tab-content active">
      <div class="import-container">
        <h2>Importer/Exporter des donn√©es</h2>
        <label for="jsonFile" class="file-input-label">Choisir un fichier JSON</label>
        <input type="file" id="jsonFile" accept=".json" class="file-input" onchange="importJSON(this.files)">
        <button class="import-btn" onclick="document.getElementById('jsonFile').click()">Importer JSON</button>
        <button class="export-btn" onclick="exportJSON()">Exporter JSON</button>
        <p><small>Importez ou exportez un fichier JSON pour sauvegarder ou charger vos donn√©es.</small></p>
      </div>

      <div class="section">
        <h2>Informations de la Le√ßon</h2>
        <label for="lessonDate">Date:</label>
        <input type="date" id="lessonDate" required>

        <label for="subject">Mati√®re:</label>
        <select id="subject" required>
          <option value="">-- S√©lectionnez une mati√®re --</option>
          <option value="math">Math√©matiques</option>
          <option value="french">Fran√ßais</option>
          <option value="history">Histoire-G√©ographie</option>
          <option value="science">Sciences</option>
          <option value="english">Anglais</option>
          <option value="art">Arts Plastiques</option>
          <option value="pe">√âducation Physique</option>
          <option value="other">Autre</option>
        </select>

        <label for="class">Classe:</label>
        <select id="class" required>
          <option value="">-- S√©lectionnez une classe --</option>
          <option value="6eme">6√®me</option>
          <option value="5eme">5√®me</option>
          <option value="4eme">4√®me</option>
          <option value="3eme">3√®me</option>
          <option value="2nde">Seconde</option>
          <option value="1ere">Premi√®re</option>
          <option value="terminale">Terminale</option>
        </select>

        <label for="lessonTitle">Titre de la le√ßon:</label>
        <div class="autocomplete-container">
          <input type="text" id="lessonTitle" placeholder="Titre de la le√ßon" required autocomplete="off">
        </div>
        <div id="titleSuggestions" class="suggestions-container"></div>
      </div>

      <div class="section">
        <h2>Contenu du Cours</h2>
        <label>Grandes lignes du cours:</label>
        <div class="rich-text-editor">
          <div class="toolbar">
            <select id="fontName" onchange="formatText('fontName', this.value, 'lessonContent')">
              <option value="Arial">Arial</option>
              <option value="Helvetica">Helvetica</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Courier New">Courier New</option>
              <option value="Verdana">Verdana</option>
              <option value="Georgia">Georgia</option>
            </select>
            <select id="fontSize" onchange="formatText('fontSize', this.value, 'lessonContent')">
              <option value="1">Tr√®s petit</option>
              <option value="2">Petit</option>
              <option value="3" selected>Normal</option>
              <option value="4">Moyen</option>
              <option value="5">Grand</option>
              <option value="6">Tr√®s grand</option>
              <option value="7">Maximum</option>
            </select>
            <button onclick="formatText('bold', null, 'lessonContent')"><strong>G</strong></button>
            <button onclick="formatText('italic', null, 'lessonContent')"><em>I</em></button>
            <button onclick="formatText('underline', null, 'lessonContent')"><u>S</u></button>
            <button onclick="formatText('insertOrderedList', null, 'lessonContent')">‚ë†</button>
            <button onclick="formatText('insertUnorderedList', null, 'lessonContent')">‚Ä¢</button>
            <input type="color" id="textColor" class="color-picker" onchange="applyColor('forecolor', this.value, 'lessonContent')" value="#000000">
            <input type="color" id="bgColor" class="color-picker" onchange="applyColor('backcolor', this.value, 'lessonContent')" value="#ffffff">
            <button onclick="formatText('removeFormat', null, 'lessonContent')">‚úï</button>
          </div>
          <div id="lessonContent" class="editor-content" contenteditable="true" placeholder="D√©crivez les points principaux abord√©s pendant le cours..."></div>
        </div>
        <div id="contentSuggestions" class="suggestions-container"></div>
      </div>

      <div class="section">
        <h2>Devoirs √† la Maison</h2>
        <label>Devoirs assign√©s:</label>
        <div class="rich-text-editor">
          <div class="toolbar">
            <select onchange="formatText('fontName', this.value, 'homework')">
              <option value="Arial">Arial</option>
              <option value="Helvetica">Helvetica</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Courier New">Courier New</option>
              <option value="Verdana">Verdana</option>
              <option value="Georgia">Georgia</option>
            </select>
            <select onchange="formatText('fontSize', this.value, 'homework')">
              <option value="1">Tr√®s petit</option>
              <option value="2">Petit</option>
              <option value="3" selected>Normal</option>
              <option value="4">Moyen</option>
              <option value="5">Grand</option>
              <option value="6">Tr√®s grand</option>
              <option value="7">Maximum</option>
            </select>
            <button onclick="formatText('bold', null, 'homework')"><strong>G</strong></button>
            <button onclick="formatText('italic', null, 'homework')"><em>I</em></button>
            <button onclick="formatText('underline', null, 'homework')"><u>S</u></button>
            <button onclick="formatText('insertOrderedList', null, 'homework')">‚ë†</button>
            <button onclick="formatText('insertUnorderedList', null, 'homework')">‚Ä¢</button>
            <input type="color" class="color-picker" onchange="applyColor('forecolor', this.value, 'homework')" value="#000000">
            <input type="color" class="color-picker" onchange="applyColor('backcolor', this.value, 'homework')" value="#ffffff">
            <button onclick="formatText('removeFormat', null, 'homework')">‚úï</button>
          </div>
          <div id="homework" class="editor-content" contenteditable="true" placeholder="D√©crivez les devoirs √† faire pour la prochaine s√©ance..."></div>
        </div>
        <div id="homeworkSuggestions" class="suggestions-container"></div>

        <label for="dueDate">Date de rendu:</label>
        <input type="date" id="dueDate">
      </div>

      <button onclick="saveLesson()">Enregistrer la Le√ßon</button>
      <button onclick="clearForm()">Effacer le Formulaire</button>
      <button class="view-btn" onclick="previewLesson()">Visualiser la Le√ßon</button>
    </div>

    <!-- Contr√¥le de Pr√©sence Tab -->
    <div id="attendance" class="tab-content">
      <div class="section">
        <h2>Contr√¥le de Pr√©sence</h2>

        <label for="attendanceDate">Date:</label>
        <input type="date" id="attendanceDate" required>

        <label for="attendanceClass">Classe:</label>
        <select id="attendanceClass" onchange="loadStudents()" required>
          <option value="">-- S√©lectionnez une classe --</option>
          <option value="6eme">6√®me</option>
          <option value="5eme">5√®me</option>
          <option value="4eme">4√®me</option>
          <option value="3eme">3√®me</option>
          <option value="2nde">Seconde</option>
          <option value="1ere">Premi√®re</option>
          <option value="terminale">Terminale</option>
        </select>

        <label for="attendanceSubject">Mati√®re:</label>
        <select id="attendanceSubject" required>
          <option value="">-- S√©lectionnez une mati√®re --</option>
          <option value="math">Math√©matiques</option>
          <option value="french">Fran√ßais</option>
          <option value="history">Histoire-G√©ographie</option>
          <option value="science">Sciences</option>
          <option value="english">Anglais</option>
          <option value="art">Arts Plastiques</option>
          <option value="pe">√âducation Physique</option>
          <option value="other">Autre</option>
        </select>

        <div class="search-box">
          <label for="studentSearch">Rechercher un √©l√®ve:</label>
          <input type="text" id="studentSearch" placeholder="Nom de l'√©l√®ve..." oninput="filterStudents()">
        </div>

        <h3>Liste des √âl√®ves</h3>
        <div id="studentsContainer" class="student-list">
          <!-- Les √©l√®ves seront charg√©s ici dynamiquement -->
        </div>

        <button onclick="saveAttendance()">Enregistrer la Pr√©sence</button>
        <button onclick="clearAttendance()">Effacer</button>
      </div>

      <div class="section">
        <h2>Historique de Pr√©sence</h2>
        <div id="attendanceHistory">
          <!-- L'historique sera charg√© ici dynamiquement -->
        </div>
      </div>
    </div>

    <!-- Voir les Entr√©es Tab -->
    <div id="view" class="tab-content">
      <div class="section">
        <h2>Filtrer les Entr√©es</h2>

        <label for="filterClass">Classe:</label>
        <select id="filterClass" onchange="filterEntries()">
          <option value="">Toutes les classes</option>
          <option value="6eme">6√®me</option>
          <option value="5eme">5√®me</option>
          <option value="4eme">4√®me</option>
          <option value="3eme">3√®me</option>
          <option value="2nde">Seconde</option>
          <option value="1ere">Premi√®re</option>
          <option value="terminale">Terminale</option>
        </select>

        <label for="filterSubject">Mati√®re:</label>
        <select id="filterSubject" onchange="filterEntries()">
          <option value="">Toutes les mati√®res</option>
          <option value="math">Math√©matiques</option>
          <option value="french">Fran√ßais</option>
          <option value="history">Histoire-G√©ographie</option>
          <option value="science">Sciences</option>
          <option value="english">Anglais</option>
          <option value="art">Arts Plastiques</option>
          <option value="pe">√âducation Physique</option>
          <option value="other">Autre</option>
        </select>

        <label for="filterDateFrom">Date de d√©but:</label>
        <input type="date" id="filterDateFrom" onchange="filterEntries()">

        <label for="filterDateTo">Date de fin:</label>
        <input type="date" id="filterDateTo" onchange="filterEntries()">
      </div>

      <div class="section">
        <h2>Le√ßons Enregistr√©es</h2>
        <button class="whatsapp-btn" onclick="sendViaWhatsApp()">
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="whatsapp-icon">
          Envoyer via WhatsApp
        </button>
        <div id="lessonsList">
          <!-- Les le√ßons seront charg√©es ici dynamiquement -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour l'aper√ßu et les alertes -->
  <div id="previewModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    // Variables globales
    let lessons = JSON.parse(localStorage.getItem('teacherLessons')) || [];
    let attendanceRecords = JSON.parse(localStorage.getItem('teacherAttendance')) || [];

    // Structure des √©l√®ves avec leur sexe
    let students = {
      '6eme': [
        { name: 'Jean Dupont', gender: 'M' },
        { name: 'Marie Martin', gender: 'F' },
        { name: 'Pierre Durand', gender: 'M' },
        { name: 'Sophie Lambert', gender: 'F' },
        { name: 'Lucie Petit', gender: 'F' }
      ],
      '5eme': [
        { name: 'Thomas Moreau', gender: 'M' },
        { name: 'Julie Laurent', gender: 'F' },
        { name: 'Nicolas Simon', gender: 'M' },
        { name: 'Camille Michel', gender: 'F' },
        { name: 'Alexandre Bernard', gender: 'M' }
      ],
      '4eme': [
        { name: 'Laura Robert', gender: 'F' },
        { name: 'Hugo Lefebvre', gender: 'M' },
        { name: 'Emma Roux', gender: 'F' },
        { name: 'Louis David', gender: 'M' },
        { name: 'Chlo√© Bertrand', gender: 'F' }
      ],
      '3eme': [
        { name: 'Mathieu Leroy', gender: 'M' },
        { name: 'Manon Morel', gender: 'F' },
        { name: 'Antoine Fournier', gender: 'M' },
        { name: 'Sarah Girard', gender: 'F' },
        { name: 'Julien Bonnet', gender: 'M' }
      ],
      '2nde': [
        { name: 'L√©a Dumont', gender: 'F' },
        { name: 'Paul Fran√ßois', gender: 'M' },
        { name: 'Zo√© Martinez', gender: 'F' },
        { name: 'Gabriel Legrand', gender: 'M' },
        { name: 'In√®s Garnier', gender: 'F' }
      ],
      '1ere': [
        { name: 'Romain Faure', gender: 'M' },
        { name: 'Elodie Rousseau', gender: 'F' },
        { name: 'Maxime Blanc', gender: 'M' },
        { name: 'Charlotte Caron', gender: 'F' },
        { name: 'Victor Henry', gender: 'M' }
      ],
      'terminale': [
        { name: 'Clara Perrot', gender: 'F' },
        { name: 'Baptiste Nicolas', gender: 'M' },
        { name: 'Margaux Meyer', gender: 'F' },
        { name: 'Arthur Adam', gender: 'M' },
        { name: 'L√©na Chevalier', gender: 'F' }
      ]
    };

    // Base de donn√©es des suggestions pour la saisie intelligente
    const smartSuggestions = {
      lessonTitles: [
        "Introduction √†",
        "R√©vision de",
        "Exercices pratiques sur",
        "Cours avanc√© de",
        "Les fondamentaux de",
        "Histoire et √©volution des",
        "Applications pratiques des",
        "Th√©orie et pratique des",
        "Analyse approfondie de",
        "Synth√®se sur"
      ],
      lessonContents: [
        "D√©finition des concepts cl√©s",
        "√âtude de cas pratiques",
        "Analyse comparative",
        "M√©thodologie d'application",
        "Exercices d'approfondissement",
        "R√©ponses aux questions fr√©quentes",
        "Perspectives historiques",
        "Applications contemporaines",
        "Synth√®se des connaissances",
        "Pr√©paration √† l'√©valuation"
      ],
      homework: [
        "Exercices pages 12-15",
        "R√©vision pour l'√©valuation",
        "Pr√©paration expos√©",
        "Recherche documentaire",
        "QCM en ligne √† compl√©ter",
        "Devoir maison √† rendre",
        "Lecture pages 45-52",
        "R√©daction de synth√®se",
        "Exercices suppl√©mentaires",
        "Pr√©paration questions oral"
      ],
      subjects: {
        math: ["alg√®bre", "g√©om√©trie", "calcul", "statistiques", "probabilit√©s", "√©quations", "fonctions", "th√©or√®mes"],
        french: ["grammaire", "conjugaison", "orthographe", "litt√©rature", "r√©daction", "analyse de texte", "vocabulaire"],
        history: ["chronologie", "civilisations", "√©v√©nements cl√©s", "personnages historiques", "cartes", "documents historiques"],
        science: ["exp√©riences", "m√©thode scientifique", "hypoth√®ses", "observations", "conclusions", "manipulations"],
        english: ["vocabulary", "grammar", "conversation", "reading comprehension", "writing", "listening exercises"],
        art: ["≈ìuvres d'art", "techniques", "artistes", "mouvements artistiques", "analyse d'≈ìuvre", "cr√©ation"],
        pe: ["√©chauffement", "exercices techniques", "r√®gles du jeu", "strat√©gies", "entra√Ænement", "performance"]
      }
    };

    // Base de donn√©es des utilisateurs (en production, utiliser un syst√®me s√©curis√©)
    const users = [
      { username: "prof1", password: "pass123", name: "Professeur Dupont" },
      { username: "prof2", password: "pass456", name: "Professeur Martin" },
      { username: "admin", password: "admin123", name: "Administrateur" }
    ];

    // V√©rifier si l'utilisateur est d√©j√† connect√© au chargement
    document.addEventListener('DOMContentLoaded', function() {
      const loggedInUser = localStorage.getItem('loggedInUser');
      if (loggedInUser) {
        showApp();
        initAutocomplete();
      } else {
        showLogin();
      }
      
      // D√©finir la date d'aujourd'hui par d√©faut
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('lessonDate').value = today;
      document.getElementById('attendanceDate').value = today;
    });

    // Fonctions d'authentification
    function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const errorElement = document.getElementById('loginError');

      // R√©initialiser le message d'erreur
      errorElement.classList.add('hidden');
      errorElement.textContent = '';

      // Validation basique
      if (!username || !password) {
        showError("Veuillez saisir un nom d'utilisateur et un mot de passe");
        return;
      }

      // V√©rifier les informations de connexion
      const user = users.find(u => u.username === username && u.password === password);

      if (user) {
        // Enregistrer l'utilisateur connect√©
        localStorage.setItem('loggedInUser', JSON.stringify(user));
        showApp();

        // Charger les donn√©es existantes
        filterEntries();
        loadAttendanceHistory();

        // Initialiser la saisie intelligente
        initAutocomplete();
      } else {
        showError("Nom d'utilisateur ou mot de passe incorrect");
      }
    }

    function logout() {
      localStorage.removeItem('loggedInUser');
      showLogin();
      // R√©initialiser les champs de connexion
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    }

    function showError(message) {
      const errorElement = document.getElementById('loginError');
      errorElement.textContent = message;
      errorElement.classList.remove('hidden');
    }

    function showApp() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('appContainer').classList.remove('hidden');
    }

    function showLogin() {
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('appContainer').classList.add('hidden');
    }

    // Fonctions pour les onglets
    function openTab(tabId) {
      // Cacher tous les onglets
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });

      // D√©sactiver tous les boutons d'onglet
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });

      // Activer l'onglet s√©lectionn√©
      document.getElementById(tabId).classList.add('active');

      // Activer le bouton de l'onglet
      document.querySelector(`.tab[onclick="openTab('${tabId}')"]`).classList.add('active');

      // Si c'est l'onglet de pr√©sence, charger les √©l√®ves
      if (tabId === 'attendance') {
        loadStudents();
      }
    }

    // Fonctions pour la gestion des le√ßons
    function saveLesson() {
      const lessonDate = document.getElementById('lessonDate').value;
      const subject = document.getElementById('subject').value;
      const classLevel = document.getElementById('class').value;
      const lessonTitle = document.getElementById('lessonTitle').value;
      const lessonContent = document.getElementById('lessonContent').innerHTML;
      const homework = document.getElementById('homework').innerHTML;
      const dueDate = document.getElementById('dueDate').value;

      if (!lessonDate || !subject || !classLevel || !lessonTitle || !lessonContent) {
        alert('Veuillez remplir tous les champs obligatoires.');
        return;
      }

      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));

      const newLesson = {
        id: Date.now(),
        date: lessonDate,
        subject: subject,
        class: classLevel,
        title: lessonTitle,
        content: lessonContent,
        homework: homework,
        dueDate: dueDate,
        teacher: loggedInUser.username // Associer la le√ßon √† l'enseignant
      };

      lessons.push(newLesson);
      localStorage.setItem('teacherLessons', JSON.stringify(lessons));

      alert('Le√ßon enregistr√©e avec succ√®s!');
      clearForm();
      filterEntries();
    }

    function clearForm() {
      document.getElementById('lessonDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('subject').value = '';
      document.getElementById('class').value = '';
      document.getElementById('lessonTitle').value = '';
      document.getElementById('lessonContent').innerHTML = '';
      document.getElementById('homework').innerHTML = '';
      document.getElementById('dueDate').value = '';
    }

    // Fonction pour visualiser la le√ßon sans modifier
    function previewLesson() {
      const lessonDate = document.getElementById('lessonDate').value;
      const subject = document.getElementById('subject').value;
      const classLevel = document.getElementById('class').value;
      const lessonTitle = document.getElementById('lessonTitle').value;
      const lessonContent = document.getElementById('lessonContent').innerHTML;
      const homework = document.getElementById('homework').innerHTML;
      const dueDate = document.getElementById('dueDate').value;

      if (!lessonDate || !subject || !classLevel || !lessonTitle || !lessonContent) {
        alert('Veuillez remplir tous les champs obligatoires pour visualiser.');
        return;
      }

      let previewHTML = `
        <h3>Aper√ßu de la Le√ßon</h3>
        <p><strong>Date:</strong> ${formatDate(lessonDate)}</p>
        <p><strong>Mati√®re:</strong> ${getSubjectName(subject)}</p>
        <p><strong>Classe:</strong> ${getClassName(classLevel)}</p>
        <p><strong>Titre:</strong> ${lessonTitle}</p>
        <div class="content">
          <p><strong>Contenu:</strong></p>
          <div class="view-mode">${lessonContent}</div>
        </div>
      `;

      if (homework) {
        previewHTML += `
          <div class="content">
            <p><strong>Devoirs:</strong></p>
            <div class="view-mode">${homework}</div>
          </div>
        `;
      }

      if (dueDate) {
        previewHTML += `<p><strong>√Ä rendre pour le:</strong> ${formatDate(dueDate)}</p>`;
      }

      showModal(previewHTML, 'Aper√ßu de la Le√ßon');
    }

    // Fonction pour exporter les donn√©es en JSON
    function exportJSON() {
      const lessonData = {
        date: document.getElementById('lessonDate').value,
        subject: document.getElementById('subject').value,
        class: document.getElementById('class').value,
        title: document.getElementById('lessonTitle').value,
        content: document.getElementById('lessonContent').innerHTML,
        homework: document.getElementById('homework').innerHTML,
        dueDate: document.getElementById('dueDate').value
      };

      // Cr√©er un blob avec les donn√©es JSON
      const dataStr = JSON.stringify(lessonData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });

      // Cr√©er un lien de t√©l√©chargement
      const link = document.createElement('a');
      link.href = URL.createObjectURL(dataBlob);
      
      // G√©n√©rer un nom de fichier avec la date et le titre
      const date = new Date().toISOString().slice(0, 10);
      const title = lessonData.title ? lessonData.title.replace(/\s+/g, '_') : 'le√ßon';
      link.download = `le√ßon_${date}_${title}.json`;
      
      // Simuler un clic sur le lien pour d√©clencher le t√©l√©chargement
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      alert('Fichier JSON export√© avec succ√®s!');
    }

    // Fonction pour importer un fichier JSON
    function importJSON(files) {
      if (files.length === 0) return;
      
      const file = files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Remplir les champs avec les donn√©es import√©es
          if (data.date) document.getElementById('lessonDate').value = data.date;
          if (data.subject) document.getElementById('subject').value = data.subject;
          if (data.class) document.getElementById('class').value = data.class;
          if (data.title) document.getElementById('lessonTitle').value = data.title;
          if (data.content) document.getElementById('lessonContent').innerHTML = data.content;
          if (data.homework) document.getElementById('homework').innerHTML = data.homework;
          if (data.dueDate) document.getElementById('dueDate').value = data.dueDate;
          
          alert('Donn√©es import√©es avec succ√®s!');
        } catch (error) {
          alert('Erreur lors de l\'importation du fichier JSON: ' + error.message);
        }
      };
      
      reader.readAsText(file);
    }

    // Fonctions pour le contr√¥le de pr√©sence
    function loadStudents() {
      const classLevel = document.getElementById('attendanceClass').value;
      if (!classLevel) return;

      const studentsContainer = document.getElementById('studentsContainer');
      studentsContainer.innerHTML = '';

      students[classLevel].forEach(student => {
        const studentItem = document.createElement('div');
        studentItem.className = 'student-item';
        studentItem.innerHTML = `
          <div class="status-options">
            <div>
              <input type="radio" name="${student.name.replace(/\s+/g, '-')}" value="present" id="${student.name.replace(/\s+/g, '-')}-present" checked>
              <label for="${student.name.replace(/\s+/g, '-')}-present">Pr√©sent(e)</label>
            </div>
            <div>
              <input type="radio" name="${student.name.replace(/\s+/g, '-')}" value="absent" id="${student.name.replace(/\s+/g, '-')}-absent">
              <label for="${student.name.replace(/\s+/g, '-')}-absent">Absent(e)</label>
            </div>
            <div>
              <input type="radio" name="${student.name.replace(/\s+/g, '-')}" value="late" id="${student.name.replace(/\s+/g, '-')}-late">
              <label for="${student.name.replace(/\s+/g, '-')}-late">En retard</label>
            </div>
          </div>
          <div class="student-info">
            <span>${student.name}</span>
            <span class="gender-icon">${student.gender === 'M' ? '‚ôÇ' : '‚ôÄ'}</span>
          </div>
        `;
        studentsContainer.appendChild(studentItem);
      });
    }

    function filterStudents() {
      const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
      const studentItems = document.querySelectorAll('.student-item');

      studentItems.forEach(item => {
        const studentName = item.querySelector('.student-info span:first-child').textContent.toLowerCase();
        if (studentName.includes(searchTerm)) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }

    function saveAttendance() {
      const attendanceDate = document.getElementById('attendanceDate').value;
      const classLevel = document.getElementById('attendanceClass').value;
      const subject = document.getElementById('attendanceSubject').value;

      if (!attendanceDate || !classLevel || !subject) {
        alert('Veuillez remplir tous les champs obligatoires.');
        return;
      }

      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));

      const attendanceData = {
        id: Date.now(),
        date: attendanceDate,
        class: classLevel,
        subject: subject,
        students: [],
        teacher: loggedInUser.username // Associer la pr√©sence √† l'enseignant
      };

      students[classLevel].forEach(student => {
        const status = document.querySelector(`input[name="${student.name.replace(/\s+/g, '-')}"]:checked`).value;
        attendanceData.students.push({
          name: student.name,
          gender: student.gender,
          status: status
        });
      });

      attendanceRecords.push(attendanceData);
      localStorage.setItem('teacherAttendance', JSON.stringify(attendanceRecords));

      alert('Pr√©sence enregistr√©e avec succ√®s!');
      loadAttendanceHistory();
    }

    function clearAttendance() {
      document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('attendanceClass').value = '';
      document.getElementById('attendanceSubject').value = '';
      document.getElementById('studentSearch').value = '';
      document.getElementById('studentsContainer').innerHTML = '';
    }

    function loadAttendanceHistory() {
      const historyContainer = document.getElementById('attendanceHistory');
      historyContainer.innerHTML = '';

      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
      const teacherRecords = attendanceRecords.filter(record => record.teacher === loggedInUser.username);

      if (teacherRecords.length === 0) {
        historyContainer.innerHTML = '<p>Aucun enregistrement de pr√©sence trouv√©.</p>';
        return;
      }

      // Trier par date (du plus r√©cent au plus ancien)
      const sortedRecords = [...teacherRecords].sort((a, b) => new Date(b.date) - new Date(a.date));

      sortedRecords.forEach(record => {
        const recordElement = document.createElement('div');
        recordElement.className = 'section';
        recordElement.style.marginBottom = '15px';

        let presentCount = 0;
        let absentCount = 0;
        let lateCount = 0;
        let presentMale = 0;
        let presentFemale = 0;
        let absentMale = 0;
        let absentFemale = 0;
        let lateMale = 0;
        let lateFemale = 0;

        record.students.forEach(student => {
          if (student.status === 'present') {
            presentCount++;
            if (student.gender === 'M') presentMale++;
            else presentFemale++;
          } else if (student.status === 'absent') {
            absentCount++;
            if (student.gender === 'M') absentMale++;
            else absentFemale++;
          } else if (student.status === 'late') {
            lateCount++;
            if (student.gender === 'M') lateMale++;
            else lateFemale++;
          }
        });

        recordElement.innerHTML = `
          <h3>${formatDate(record.date)} - ${getSubjectName(record.subject)} - ${getClassName(record.class)}</h3>
          <div class="attendance-summary">
            <h4>R√©sum√© de pr√©sence</h4>
            <p class="summary-item"><strong>Total √©l√®ves:</strong> ${record.students.length}</p>
            <p class="summary-item"><strong>Pr√©sents:</strong> ${presentCount} (Gar√ßons: ${presentMale}, Filles: ${presentFemale})</p>
            <p class="summary-item"><strong>Absents:</strong> ${absentCount} (Gar√ßons: ${absentMale}, Filles: ${absentFemale})</p>
            <p class="summary-item"><strong>Retards:</strong> ${lateCount} (Gar√ßons: ${lateMale}, Filles: ${lateFemale})</p>
          </div>
          <button onclick="viewAttendanceDetails(${record.id})">Voir d√©tails</button>
          <button onclick="deleteAttendanceRecord(${record.id})">Supprimer</button>
        `;

        historyContainer.appendChild(recordElement);
      });
    }

    function viewAttendanceDetails(recordId) {
      const record = attendanceRecords.find(r => r.id === recordId);
      if (!record) return;

      let detailsHTML = `
        <h3>D√©tails de pr√©sence - ${formatDate(record.date)}</h3>
        <p>Mati√®re: ${getSubjectName(record.subject)}</p>
        <p>Classe: ${getClassName(record.class)}</p>
        <table>
          <tr>
            <th>√âl√®ve</th>
            <th>Sexe</th>
            <th>Statut</th>
          </tr>
      `;

      record.students.forEach(student => {
        let statusClass = '';
        if (student.status === 'present') statusClass = 'status-present';
        else if (student.status === 'absent') statusClass = 'status-absent';
        else if (student.status === 'late') statusClass = 'status-late';

        detailsHTML += `
          <tr>
            <td>${student.name}</td>
            <td>${student.gender === 'M' ? 'Gar√ßon' : 'Fille'}</td>
            <td class="${statusClass}">${getStatusName(student.status)}</td>
          </tr>
        `;
      });

      detailsHTML += '</table>';

      showModal(detailsHTML, 'D√©tails de pr√©sence');
    }

    function deleteAttendanceRecord(recordId) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cet enregistrement de pr√©sence?')) {
        attendanceRecords = attendanceRecords.filter(r => r.id !== recordId);
        localStorage.setItem('teacherAttendance', JSON.stringify(attendanceRecords));
        loadAttendanceHistory();
      }
    }

    // Fonctions pour visualiser les entr√©es
    function filterEntries() {
      const classFilter = document.getElementById('filterClass').value;
      const subjectFilter = document.getElementById('filterSubject').value;
      const dateFrom = document.getElementById('filterDateFrom').value;
      const dateTo = document.getElementById('filterDateTo').value;

      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
      let filteredLessons = lessons.filter(lesson => lesson.teacher === loggedInUser.username);

      if (classFilter) {
        filteredLessons = filteredLessons.filter(lesson => lesson.class === classFilter);
      }

      if (subjectFilter) {
        filteredLessons = filteredLessons.filter(lesson => lesson.subject === subjectFilter);
      }

      if (dateFrom) {
        filteredLessons = filteredLessons.filter(lesson => lesson.date >= dateFrom);
      }

      if (dateTo) {
        filteredLessons = filteredLessons.filter(lesson => lesson.date <= dateTo);
      }

      displayLessons(filteredLessons);
    }

    function displayLessons(lessonsToDisplay) {
      const lessonsList = document.getElementById('lessonsList');
      lessonsList.innerHTML = '';

      if (lessonsToDisplay.length === 0) {
        lessonsList.innerHTML = '<p>Aucune le√ßon trouv√©e avec les crit√®res s√©lectionn√©s.</p>';
        return;
      }

      // Trier par date (du plus r√©cent au plus ancien)
      const sortedLessons = [...lessonsToDisplay].sort((a, b) => new Date(b.date) - new Date(a.date));

      sortedLessons.forEach(lesson => {
        const lessonElement = document.createElement('div');
        lessonElement.className = 'section';
        lessonElement.style.marginBottom = '15px';

        lessonElement.innerHTML = `
          <h3>${formatDate(lesson.date)} - ${getSubjectName(lesson.subject)} - ${getClassName(lesson.class)}</h3>
          <h4>${lesson.title}</h4>
          <p><strong>Contenu du cours:</strong></p>
          <div class="lesson-content">${lesson.content}</div>
          ${lesson.homework ? `<p><strong>Devoirs:</strong></p><div class="lesson-content">${lesson.homework}</div>` : ''}
          ${lesson.dueDate ? `<p><strong>√Ä rendre pour le:</strong> ${formatDate(lesson.dueDate)}</p>` : ''}
          <button onclick="editLesson(${lesson.id})">Modifier</button>
          <button onclick="deleteLesson(${lesson.id})">Supprimer</button>
        `;

        lessonsList.appendChild(lessonElement);
      });
    }

    function editLesson(lessonId) {
      const lesson = lessons.find(l => l.id === lessonId);
      if (!lesson) return;

      openTab('lesson');

      document.getElementById('lessonDate').value = lesson.date;
      document.getElementById('subject').value = lesson.subject;
      document.getElementById('class').value = lesson.class;
      document.getElementById('lessonTitle').value = lesson.title;
      document.getElementById('lessonContent').innerHTML = lesson.content;
      document.getElementById('homework').innerHTML = lesson.homework;
      document.getElementById('dueDate').value = lesson.dueDate;

      // Supprimer l'ancienne version
      lessons = lessons.filter(l => l.id !== lessonId);
      localStorage.setItem('teacherLessons', JSON.stringify(lessons));
    }

    function deleteLesson(lessonId) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cette le√ßon?')) {
        lessons = lessons.filter(l => l.id !== lessonId);
        localStorage.setItem('teacherLessons', JSON.stringify(lessons));
        filterEntries();
      }
    }

    // Fonction pour envoyer via WhatsApp
    function sendViaWhatsApp() {
      // R√©cup√©rer les donn√©es filtr√©es
      const classFilter = document.getElementById('filterClass').value;
      const subjectFilter = document.getElementById('filterSubject').value;
      const dateFrom = document.getElementById('filterDateFrom').value;
      const dateTo = document.getElementById('filterDateTo').value;

      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
      let filteredLessons = lessons.filter(lesson => lesson.teacher === loggedInUser.username);

      if (classFilter) {
        filteredLessons = filteredLessons.filter(lesson => lesson.class === classFilter);
      }

      if (subjectFilter) {
        filteredLessons = filteredLessons.filter(lesson => lesson.subject === subjectFilter);
      }

      if (dateFrom) {
        filteredLessons = filteredLessons.filter(lesson => lesson.date >= dateFrom);
      }

      if (dateTo) {
        filteredLessons = filteredLessons.filter(lesson => lesson.date <= dateTo);
      }

      // Formater le message
      let message = "üìö R√©sum√© des le√ßons enregistr√©es:\n\n";

      filteredLessons.forEach(lesson => {
        message += `üìÖ ${formatDate(lesson.date)}\n`;
        message += `üè´ ${getClassName(lesson.class)} - ${getSubjectName(lesson.subject)}\n`;
        message += `üìñ ${lesson.title}\n`;

        // Convertir le HTML en texte brut pour WhatsApp
        const contentDiv = document.createElement('div');
        contentDiv.innerHTML = lesson.content;
        const plainContent = contentDiv.textContent || contentDiv.innerText || '';

        message += `üìù ${plainContent.substring(0, 100)}${plainContent.length > 100 ? '...' : ''}\n`;

        if (lesson.homework) {
          const homeworkDiv = document.createElement('div');
          homeworkDiv.innerHTML = lesson.homework;
          const plainHomework = homeworkDiv.textContent || homeworkDiv.innerText || '';

          message += `üìå Devoirs: ${plainHomework.substring(0, 100)}${plainHomework.length > 100 ? '...' : ''}\n`;
        }
        if (lesson.dueDate) {
          message += `‚è∞ √Ä rendre pour le: ${formatDate(lesson.dueDate)}\n`;
        }
        message += "\n‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï\n\n";
      });

      // Encoder le message pour l'URL
      const encodedMessage = encodeURIComponent(message);

      // Num√©ro WhatsApp (92871605)
      const phoneNumber = "92871605";

      // Cr√©er le lien WhatsApp
      const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;

      // Ouvrir dans un nouvel onglet
      window.open(whatsappUrl, '_blank');
    }

    // Fonctions utilitaires
    function formatDate(dateString) {
      if (!dateString) return '';
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('fr-FR', options);
    }

    function getSubjectName(subjectCode) {
      const subjects = {
        'math': 'Math√©matiques',
        'french': 'Fran√ßais',
        'history': 'Histoire-G√©ographie',
        'science': 'Sciences',
        'english': 'Anglais',
        'art': 'Arts Plastiques',
        'pe': '√âducation Physique',
        'other': 'Autre'
      };
      return subjects[subjectCode] || subjectCode;
    }

    function getClassName(classCode) {
      const classes = {
        '6eme': '6√®me',
        '5eme': '5√®me',
        '4eme': '4√®me',
        '3eme': '3√®me',
        '2nde': 'Seconde',
        '1ere': 'Premi√®re',
        'terminale': 'Terminale'
      };
      return classes[classCode] || classCode;
    }

    function getStatusName(statusCode) {
      const statuses = {
        'present': 'Pr√©sent(e)',
        'absent': 'Absent(e)',
        'late': 'En retard'
      };
      return statuses[statusCode] || statusCode;
    }

    function alert(message, title = 'Information') {
      showModal(message, title);
    }

    function showModal(content, title = 'Information') {
      const modal = document.getElementById('previewModal');
      const modalContent = document.getElementById('modalContent');
      
      modalContent.innerHTML = `
        <h2>${title}</h2>
        <div>${content}</div>
        <button style="margin-top: 15px; padding: 5px 10px;" onclick="closeModal()">Fermer</button>
      `;
      
      modal.style.display = 'block';
    }

    function closeModal() {
      document.getElementById('previewModal').style.display = 'none';
    }

    // Fermer la modal en cliquant en dehors
    window.onclick = function(event) {
      const modal = document.getElementById('previewModal');
      if (event.target == modal) {
        closeModal();
      }
    };

    // Fonctions pour la saisie intelligente
    function initAutocomplete() {
      // Configuration de l'autocompl√©tion pour le titre de le√ßon
      const lessonTitleInput = document.getElementById('lessonTitle');
      lessonTitleInput.addEventListener('input', function() {
        const subject = document.getElementById('subject').value;
        showTitleSuggestions(this.value, subject);
      });

      // Configuration de l'autocompl√©tion pour le contenu de le√ßon
      const lessonContentInput = document.getElementById('lessonContent');
      lessonContentInput.addEventListener('input', function() {
        showContentSuggestions(this.textContent);
      });

      // Configuration de l'autocompl√©tion pour les devoirs
      const homeworkInput = document.getElementById('homework');
      homeworkInput.addEventListener('input', function() {
        showHomeworkSuggestions(this.textContent);
      });

      // Ajouter les √©couteurs pour les changements de mati√®re
      document.getElementById('subject').addEventListener('change', function() {
        const title = document.getElementById('lessonTitle').value;
        if (title) {
          showTitleSuggestions(title, this.value);
        }
      });
    }

    function showTitleSuggestions(input, subject) {
      const suggestionsContainer = document.getElementById('titleSuggestions');
      suggestionsContainer.innerHTML = '';

      if (!input && !subject) return;

      let suggestions = [];

      // Si une mati√®re est s√©lectionn√©e, proposer des suggestions contextuelles
      if (subject && subject !== 'other') {
        const subjectKeywords = smartSuggestions.subjects[subject] || [];
        suggestions = smartSuggestions.lessonTitles.map(title => {
          return title + ' ' + (subjectKeywords[0] || 'cette mati√®re');
        });
      } else {
        suggestions = [...smartSuggestions.lessonTitles];
      }

      // Filtrer les suggestions en fonction de la saisie
      if (input) {
        const inputLower = input.toLowerCase();
        suggestions = suggestions.filter(suggestion => 
          suggestion.toLowerCase().includes(inputLower)
        );
      }

      // Afficher les suggestions (limit√© √† 5)
      suggestions.slice(0, 5).forEach(suggestion => {
        const chip = document.createElement('span');
        chip.className = 'suggestion-chip';
        chip.textContent = suggestion;
        chip.addEventListener('click', function() {
          document.getElementById('lessonTitle').value = suggestion;
          suggestionsContainer.innerHTML = '';
        });
        suggestionsContainer.appendChild(chip);
      });
    }

    function showContentSuggestions(input) {
      const suggestionsContainer = document.getElementById('contentSuggestions');
      suggestionsContainer.innerHTML = '';

      if (!input) return;

      // Filtrer les suggestions en fonction de la saisie
      const inputLower = input.toLowerCase();
      const suggestions = smartSuggestions.lessonContents.filter(suggestion => 
        suggestion.toLowerCase().includes(inputLower)
      );

      // Afficher les suggestions (limit√© √† 5)
      suggestions.slice(0, 5).forEach(suggestion => {
        const chip = document.createElement('span');
        chip.className = 'suggestion-chip';
        chip.textContent = suggestion;
        chip.addEventListener('click', function() {
          const contentInput = document.getElementById('lessonContent');
          formatText('insertText', suggestion, 'lessonContent');
          suggestionsContainer.innerHTML = '';
        });
        suggestionsContainer.appendChild(chip);
      });
    }

    function showHomeworkSuggestions(input) {
      const suggestionsContainer = document.getElementById('homeworkSuggestions');
      suggestionsContainer.innerHTML = '';

      if (!input) return;

      // Filtrer les suggestions en fonction de la saisie
      const inputLower = input.toLowerCase();
      const suggestions = smartSuggestions.homework.filter(suggestion => 
        suggestion.toLowerCase().includes(inputLower)
      );

      // Afficher les suggestions (limit√© √† 5)
      suggestions.slice(0, 5).forEach(suggestion => {
        const chip = document.createElement('span');
        chip.className = 'suggestion-chip';
        chip.textContent = suggestion;
        chip.addEventListener('click', function() {
          const homeworkInput = document.getElementById('homework');
          formatText('insertText', suggestion, 'homework');
          suggestionsContainer.innerHTML = '';
        });
        suggestionsContainer.appendChild(chip);
      });
    }

    // Fonctions pour l'√©diteur de texte enrichi
    function formatText(command, value = null, targetId) {
      const target = document.getElementById(targetId);
      target.focus();
      document.execCommand(command, false, value);
    }

    function applyColor(command, color, targetId) {
      const target = document.getElementById(targetId);
      target.focus();
      document.execCommand(command, false, color);
    }
  </script>
</body>
</html>
