<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cahier de Texte Num√©rique</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="password"], input[type="date"], textarea, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #ddd;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .student-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .student-item {
            display: flex;
            align-items: center;
            background: #eee;
            padding: 8px;
            border-radius: 4px;
        }
        .student-item input {
            margin-right: 10px;
        }
        .search-box {
            margin-bottom: 15px;
        }
        .status-present {
            color: green;
        }
        .status-absent {
            color: red;
        }
        .status-late {
            color: orange;
        }
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .whatsapp-btn:hover {
            background-color: #128C7E;
        }
        .whatsapp-icon {
            width: 20px;
            height: 20px;
        }
        .logout-btn {
            background-color: #e74c3c;
            float: right;
        }
        .logout-btn:hover {
            background-color: #c0392b;
        }
        .hidden {
            display: none;
        }
        .error-message {
            color: #e74c3c;
            margin-bottom: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- √âcran de connexion -->
    <div id="loginScreen" class="login-container">
        <h1>Connexion Enseignants</h1>
        <div id="loginError" class="error-message hidden"></div>
        <label for="username">Nom d'utilisateur:</label>
        <input type="text" id="username" placeholder="Votre nom d'utilisateur">
        
        <label for="password">Mot de passe:</label>
        <input type="password" id="password" placeholder="Votre mot de passe">
        
        <button onclick="login()">Se connecter</button>
    </div>

    <!-- Application principale (cach√©e jusqu'√† l'authentification) -->
    <div id="appContainer" class="container hidden">
        <button class="logout-btn" onclick="logout()">D√©connexion</button>
        <h1>Cahier de Texte Num√©rique</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="openTab('lesson')">Nouvelle Le√ßon</div>
            <div class="tab" onclick="openTab('attendance')">Pr√©sence</div>
            <div class="tab" onclick="openTab('view')">Voir les Entr√©es</div>
        </div>
        
        <!-- Nouvelle Le√ßon Tab -->
        <div id="lesson" class="tab-content active">
            <div class="section">
                <h2>Informations de la Le√ßon</h2>
                <label for="lessonDate">Date:</label>
                <input type="date" id="lessonDate" required>
                
                <label for="subject">Mati√®re:</label>
                <select id="subject" required>
                    <option value="">-- S√©lectionnez une mati√®re --</option>
                    <option value="math">Math√©matiques</option>
                    <option value="french">Fran√ßais</option>
                    <option value="history">Histoire-G√©ographie</option>
                    <option value="science">Sciences</option>
                    <option value="english">Anglais</option>
                    <option value="art">Arts Plastiques</option>
                    <option value="pe">√âducation Physique</option>
                    <option value="other">Autre</option>
                </select>
                
                <label for="class">Classe:</label>
                <select id="class" required>
                    <option value="">-- S√©lectionnez une classe --</option>
                    <option value="6eme">6√®me</option>
                    <option value="5eme">5√®me</option>
                    <option value="4eme">4√®me</option>
                    <option value="3eme">3√®me</option>
                    <option value="2nde">Seconde</option>
                    <option value="1ere">Premi√®re</option>
                    <option value="terminale">Terminale</option>
                </select>
                
                <label for="lessonTitle">Titre de la le√ßon:</label>
                <input type="text" id="lessonTitle" placeholder="Titre de la le√ßon" required>
            </div>
            
            <div class="section">
                <h2>Contenu du Cours</h2>
                <label for="lessonContent">Grandes lignes du cours:</label>
                <textarea id="lessonContent" placeholder="D√©crivez les points principaux abord√©s pendant le cours..." required></textarea>
            </div>
            
            <div class="section">
                <h2>Devoirs √† la Maison</h2>
                <label for="homework">Devoirs assign√©s:</label>
                <textarea id="homework" placeholder="D√©crivez les devoirs √† faire pour la prochaine s√©ance..."></textarea>
                
                <label for="dueDate">Date de rendu:</label>
                <input type="date" id="dueDate">
            </div>
            
            <button onclick="saveLesson()">Enregistrer la Le√ßon</button>
            <button onclick="clearForm()">Effacer le Formulaire</button>
        </div>
        
        <!-- Contr√¥le de Pr√©sence Tab -->
        <div id="attendance" class="tab-content">
            <div class="section">
                <h2>Contr√¥le de Pr√©sence</h2>
                
                <label for="attendanceDate">Date:</label>
                <input type="date" id="attendanceDate" required>
                
                <label for="attendanceClass">Classe:</label>
                <select id="attendanceClass" onchange="loadStudents()" required>
                    <option value="">-- S√©lectionnez une classe --</option>
                    <option value="6eme">6√®me</option>
                    <option value="5eme">5√®me</option>
                    <option value="4eme">4√®me</option>
                    <option value="3eme">3√®me</option>
                    <option value="2nde">Seconde</option>
                    <option value="1ere">Premi√®re</option>
                    <option value="terminale">Terminale</option>
                </select>
                
                <label for="attendanceSubject">Mati√®re:</label>
                <select id="attendanceSubject" required>
                    <option value="">-- S√©lectionnez une mati√®re --</option>
                    <option value="math">Math√©matiques</option>
                    <option value="french">Fran√ßais</option>
                    <option value="history">Histoire-G√©ographie</option>
                    <option value="science">Sciences</option>
                    <option value="english">Anglais</option>
                    <option value="art">Arts Plastiques</option>
                    <option value="pe">√âducation Physique</option>
                    <option value="other">Autre</option>
                </select>
                
                <div class="search-box">
                    <label for="studentSearch">Rechercher un √©l√®ve:</label>
                    <input type="text" id="studentSearch" placeholder="Nom de l'√©l√®ve..." oninput="filterStudents()">
                </div>
                
                <h3>Liste des √âl√®ves</h3>
                <div id="studentsContainer" class="student-list">
                    <!-- Les √©l√®ves seront charg√©s ici dynamiquement -->
                </div>
                
                <button onclick="saveAttendance()">Enregistrer la Pr√©sence</button>
                <button onclick="clearAttendance()">Effacer</button>
            </div>
            
            <div class="section">
                <h2>Historique de Pr√©sence</h2>
                <div id="attendanceHistory">
                    <!-- L'historique sera charg√© ici dynamiquement -->
                </div>
            </div>
        </div>
        
        <!-- Voir les Entr√©es Tab -->
        <div id="view" class="tab-content">
            <div class="section">
                <h2>Filtrer les Entr√©es</h2>
                
                <label for="filterClass">Classe:</label>
                <select id="filterClass" onchange="filterEntries()">
                    <option value="">Toutes les classes</option>
                    <option value="6eme">6√®me</option>
                    <option value="5eme">5√®me</option>
                    <option value="4eme">4√®me</option>
                    <option value="3eme">3√®me</option>
                    <option value="2nde">Seconde</option>
                    <option value="1ere">Premi√®re</option>
                    <option value="terminale">Terminale</option>
                </select>
                
                <label for="filterSubject">Mati√®re:</label>
                <select id="filterSubject" onchange="filterEntries()">
                    <option value="">Toutes les mati√®res</option>
                    <option value="math">Math√©matiques</option>
                    <option value="french">Fran√ßais</option>
                    <option value="history">Histoire-G√©ographie</option>
                    <option value="science">Sciences</option>
                    <option value="english">Anglais</option>
                    <option value="art">Arts Plastiques</option>
                    <option value="pe">√âducation Physique</option>
                    <option value="other">Autre</option>
                </select>
                
                <label for="filterDateFrom">Date de d√©but:</label>
                <input type="date" id="filterDateFrom" onchange="filterEntries()">
                
                <label for="filterDateTo">Date de fin:</label>
                <input type="date" id="filterDateTo" onchange="filterEntries()">
            </div>
            
            <div class="section">
                <h2>Le√ßons Enregistr√©es</h2>
                <button class="whatsapp-btn" onclick="sendViaWhatsApp()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="whatsapp-icon">
                    Envoyer via WhatsApp
                </button>
                <div id="lessonsList">
                    <!-- Les le√ßons seront charg√©es ici dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let lessons = JSON.parse(localStorage.getItem('teacherLessons')) || [];
        let attendanceRecords = JSON.parse(localStorage.getItem('teacherAttendance')) || [];
        let students = {
            '6eme': ['Jean Dupont', 'Marie Martin', 'Pierre Durand', 'Sophie Lambert', 'Lucie Petit'],
            '5eme': ['Thomas Moreau', 'Julie Laurent', 'Nicolas Simon', 'Camille Michel', 'Alexandre Bernard'],
            '4eme': ['Laura Robert', 'Hugo Lefebvre', 'Emma Roux', 'Louis David', 'Chlo√© Bertrand'],
            '3eme': ['Mathieu Leroy', 'Manon Morel', 'Antoine Fournier', 'Sarah Girard', 'Julien Bonnet'],
            '2nde': ['L√©a Dumont', 'Paul Fran√ßois', 'Zo√© Martinez', 'Gabriel Legrand', 'In√®s Garnier'],
            '1ere': ['Romain Faure', 'Elodie Rousseau', 'Maxime Blanc', 'Charlotte Caron', 'Victor Henry'],
            'terminale': ['Clara Perrot', 'Baptiste Nicolas', 'Margaux Meyer', 'Arthur Adam', 'L√©na Chevalier']
        };

        // Base de donn√©es des utilisateurs (en production, utiliser un syst√®me s√©curis√©)
        const users = [
            { username: "prof1", password: "pass123", name: "Professeur Dupont" },
            { username: "prof2", password: "pass456", name: "Professeur Martin" },
            { username: "admin", password: "admin123", name: "Administrateur" }
        ];

        // V√©rifier si l'utilisateur est d√©j√† connect√© au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (loggedInUser) {
                showApp();
            } else {
                showLogin();
            }
        });

        // Fonctions d'authentification
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');

            // R√©initialiser le message d'erreur
            errorElement.classList.add('hidden');
            errorElement.textContent = '';

            // Validation basique
            if (!username || !password) {
                showError("Veuillez saisir un nom d'utilisateur et un mot de passe");
                return;
            }

            // V√©rifier les informations de connexion
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // Enregistrer l'utilisateur connect√©
                localStorage.setItem('loggedInUser', JSON.stringify(user));
                showApp();
                
                // D√©finir la date d'aujourd'hui par d√©faut
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('lessonDate').value = today;
                document.getElementById('attendanceDate').value = today;
                
                // Charger les donn√©es existantes
                filterEntries();
                loadAttendanceHistory();
            } else {
                showError("Nom d'utilisateur ou mot de passe incorrect");
            }
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            showLogin();
            // R√©initialiser les champs de connexion
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showError(message) {
            const errorElement = document.getElementById('loginError');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
        }
        
        // Fonctions pour les onglets
        function openTab(tabId) {
            // Cacher tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // D√©sactiver tous les boutons d'onglet
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            document.getElementById(tabId).classList.add('active');
            
            // Activer le bouton de l'onglet
            document.querySelector(`.tab[onclick="openTab('${tabId}')"]`).classList.add('active');
            
            // Si c'est l'onglet de pr√©sence, charger les √©l√®ves
            if (tabId === 'attendance') {
                loadStudents();
            }
        }
        
        // Fonctions pour la gestion des le√ßons
        function saveLesson() {
            const lessonDate = document.getElementById('lessonDate').value;
            const subject = document.getElementById('subject').value;
            const classLevel = document.getElementById('class').value;
            const lessonTitle = document.getElementById('lessonTitle').value;
            const lessonContent = document.getElementById('lessonContent').value;
            const homework = document.getElementById('homework').value;
            const dueDate = document.getElementById('dueDate').value;
            
            if (!lessonDate || !subject || !classLevel || !lessonTitle || !lessonContent) {
                alert('Veuillez remplir tous les champs obligatoires.');
                return;
            }
            
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            
            const newLesson = {
                id: Date.now(),
                date: lessonDate,
                subject: subject,
                class: classLevel,
                title: lessonTitle,
                content: lessonContent,
                homework: homework,
                dueDate: dueDate,
                teacher: loggedInUser.username // Associer la le√ßon √† l'enseignant
            };
            
            lessons.push(newLesson);
            localStorage.setItem('teacherLessons', JSON.stringify(lessons));
            
            alert('Le√ßon enregistr√©e avec succ√®s!');
            clearForm();
            filterEntries();
        }
        
        function clearForm() {
            document.getElementById('lessonDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('subject').value = '';
            document.getElementById('class').value = '';
            document.getElementById('lessonTitle').value = '';
            document.getElementById('lessonContent').value = '';
            document.getElementById('homework').value = '';
            document.getElementById('dueDate').value = '';
        }
        
        // Fonctions pour le contr√¥le de pr√©sence
        function loadStudents() {
            const classLevel = document.getElementById('attendanceClass').value;
            if (!classLevel) return;
            
            const studentsContainer = document.getElementById('studentsContainer');
            studentsContainer.innerHTML = '';
            
            students[classLevel].forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <input type="radio" name="${student}" value="present" id="${student}-present" checked>
                    <label for="${student}-present">Pr√©sent(e)</label>
                    
                    <input type="radio" name="${student}" value="absent" id="${student}-absent">
                    <label for="${student}-absent">Absent(e)</label>
                    
                    <input type="radio" name="${student}" value="late" id="${student}-late">
                    <label for="${student}-late">En retard</label>
                    
                    <span>${student}</span>
                `;
                studentsContainer.appendChild(studentItem);
            });
        }
        
        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const studentItems = document.querySelectorAll('.student-item');
            
            studentItems.forEach(item => {
                const studentName = item.textContent.toLowerCase();
                if (studentName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function saveAttendance() {
            const attendanceDate = document.getElementById('attendanceDate').value;
            const classLevel = document.getElementById('attendanceClass').value;
            const subject = document.getElementById('attendanceSubject').value;
            
            if (!attendanceDate || !classLevel || !subject) {
                alert('Veuillez remplir tous les champs obligatoires.');
                return;
            }
            
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            
            const attendanceData = {
                id: Date.now(),
                date: attendanceDate,
                class: classLevel,
                subject: subject,
                students: [],
                teacher: loggedInUser.username // Associer la pr√©sence √† l'enseignant
            };
            
            students[classLevel].forEach(student => {
                const status = document.querySelector(`input[name="${student}"]:checked`).value;
                attendanceData.students.push({
                    name: student,
                    status: status
                });
            });
            
            attendanceRecords.push(attendanceData);
            localStorage.setItem('teacherAttendance', JSON.stringify(attendanceRecords));
            
            alert('Pr√©sence enregistr√©e avec succ√®s!');
            loadAttendanceHistory();
        }
        
        function clearAttendance() {
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('attendanceClass').value = '';
            document.getElementById('attendanceSubject').value = '';
            document.getElementById('studentSearch').value = '';
            document.getElementById('studentsContainer').innerHTML = '';
        }
        
        function loadAttendanceHistory() {
            const historyContainer = document.getElementById('attendanceHistory');
            historyContainer.innerHTML = '';
            
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            const teacherRecords = attendanceRecords.filter(record => record.teacher === loggedInUser.username);
            
            if (teacherRecords.length === 0) {
                historyContainer.innerHTML = '<p>Aucun enregistrement de pr√©sence trouv√©.</p>';
                return;
            }
            
            // Trier par date (du plus r√©cent au plus ancien)
            const sortedRecords = [...teacherRecords].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedRecords.forEach(record => {
                const recordElement = document.createElement('div');
                recordElement.className = 'section';
                recordElement.style.marginBottom = '15px';
                
                let presentCount = 0;
                let absentCount = 0;
                let lateCount = 0;
                
                record.students.forEach(student => {
                    if (student.status === 'present') presentCount++;
                    else if (student.status === 'absent') absentCount++;
                    else if (student.status === 'late') lateCount++;
                });
                
                recordElement.innerHTML = `
                    <h3>${formatDate(record.date)} - ${getSubjectName(record.subject)} - ${getClassName(record.class)}</h3>
                    <p>Pr√©sents: ${presentCount} | Absents: ${absentCount} | Retards: ${lateCount}</p>
                    <button onclick="viewAttendanceDetails(${record.id})">Voir d√©tails</button>
                    <button onclick="deleteAttendanceRecord(${record.id})">Supprimer</button>
                `;
                
                historyContainer.appendChild(recordElement);
            });
        }
        
        function viewAttendanceDetails(recordId) {
            const record = attendanceRecords.find(r => r.id === recordId);
            if (!record) return;
            
            let detailsHTML = `
                <h3>D√©tails de pr√©sence - ${formatDate(record.date)}</h3>
                <p>Mati√®re: ${getSubjectName(record.subject)}</p>
                <p>Classe: ${getClassName(record.class)}</p>
                <table>
                    <tr>
                        <th>√âl√®ve</th>
                        <th>Statut</th>
                    </tr>
            `;
            
            record.students.forEach(student => {
                let statusClass = '';
                if (student.status === 'present') statusClass = 'status-present';
                else if (student.status === 'absent') statusClass = 'status-absent';
                else if (student.status === 'late') statusClass = 'status-late';
                
                detailsHTML += `
                    <tr>
                        <td>${student.name}</td>
                        <td class="${statusClass}">${getStatusName(student.status)}</td>
                    </tr>
                `;
            });
            
            detailsHTML += '</table>';
            
            alert(detailsHTML, 'D√©tails de pr√©sence');
        }
        
        function deleteAttendanceRecord(recordId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet enregistrement de pr√©sence?')) {
                attendanceRecords = attendanceRecords.filter(r => r.id !== recordId);
                localStorage.setItem('teacherAttendance', JSON.stringify(attendanceRecords));
                loadAttendanceHistory();
            }
        }
        
        // Fonctions pour visualiser les entr√©es
        function filterEntries() {
            const classFilter = document.getElementById('filterClass').value;
            const subjectFilter = document.getElementById('filterSubject').value;
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            let filteredLessons = lessons.filter(lesson => lesson.teacher === loggedInUser.username);
            
            if (classFilter) {
                filteredLessons = filteredLessons.filter(lesson => lesson.class === classFilter);
            }
            
            if (subjectFilter) {
                filteredLessons = filteredLessons.filter(lesson => lesson.subject === subjectFilter);
            }
            
            if (dateFrom) {
                filteredLessons = filteredLessons.filter(lesson => lesson.date >= dateFrom);
            }
            
            if (dateTo) {
                filteredLessons = filteredLessons.filter(lesson => lesson.date <= dateTo);
            }
            
            displayLessons(filteredLessons);
        }
        
        function displayLessons(lessonsToDisplay) {
            const lessonsList = document.getElementById('lessonsList');
            lessonsList.innerHTML = '';
            
            if (lessonsToDisplay.length === 0) {
                lessonsList.innerHTML = '<p>Aucune le√ßon trouv√©e avec les crit√®res s√©lectionn√©s.</p>';
                return;
            }
            
            // Trier par date (du plus r√©cent au plus ancien)
            const sortedLessons = [...lessonsToDisplay].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedLessons.forEach(lesson => {
                const lessonElement = document.createElement('div');
                lessonElement.className = 'section';
                lessonElement.style.marginBottom = '15px';
                
                lessonElement.innerHTML = `
                    <h3>${formatDate(lesson.date)} - ${getSubjectName(lesson.subject)} - ${getClassName(lesson.class)}</h3>
                    <h4>${lesson.title}</h4>
                    <p><strong>Contenu du cours:</strong> ${lesson.content}</p>
                    ${lesson.homework ? `<p><strong>Devoirs:</strong> ${lesson.homework}</p>` : ''}
                    ${lesson.dueDate ? `<p><strong>√Ä rendre pour le:</strong> ${formatDate(lesson.dueDate)}</p>` : ''}
                    <button onclick="editLesson(${lesson.id})">Modifier</button>
                    <button onclick="deleteLesson(${lesson.id})">Supprimer</button>
                `;
                
                lessonsList.appendChild(lessonElement);
            });
        }
        
        function editLesson(lessonId) {
            const lesson = lessons.find(l => l.id === lessonId);
            if (!lesson) return;
            
            openTab('lesson');
            
            document.getElementById('lessonDate').value = lesson.date;
            document.getElementById('subject').value = lesson.subject;
            document.getElementById('class').value = lesson.class;
            document.getElementById('lessonTitle').value = lesson.title;
            document.getElementById('lessonContent').value = lesson.content;
            document.getElementById('homework').value = lesson.homework;
            document.getElementById('dueDate').value = lesson.dueDate;
            
            // Supprimer l'ancienne version
            lessons = lessons.filter(l => l.id !== lessonId);
        }
        
        function deleteLesson(lessonId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette le√ßon?')) {
                lessons = lessons.filter(l => l.id !== lessonId);
                localStorage.setItem('teacherLessons', JSON.stringify(lessons));
                filterEntries();
            }
        }
        
        // Fonction pour envoyer via WhatsApp
        function sendViaWhatsApp() {
            // R√©cup√©rer les donn√©es filtr√©es
            const classFilter = document.getElementById('filterClass').value;
            const subjectFilter = document.getElementById('filterSubject').value;
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            let filteredLessons = lessons.filter(lesson => lesson.teacher === loggedInUser.username);
            
            if (classFilter) {
                filteredLessons = filteredLessons.filter(lesson => lesson.class === classFilter);
            }
            
            if (subjectFilter) {
                filteredLessons = filteredLessons.filter(lesson => lesson.subject === subjectFilter);
            }
            
            if (dateFrom) {
                filteredLessons = filteredLessons.filter(lesson => lesson.date >= dateFrom);
            }
            
            if (dateTo) {
                filteredLessons = filteredLessons.filter(lesson => lesson.date <= dateTo);
            }

            // Formater le message
            let message = "üìö R√©sum√© des le√ßons enregistr√©es:\n\n";
            
            filteredLessons.forEach(lesson => {
                message += `üìÖ ${formatDate(lesson.date)}\n`;
                message += `üè´ ${getClassName(lesson.class)} - ${getSubjectName(lesson.subject)}\n`;
                message += `üìñ ${lesson.title}\n`;
                message += `üìù ${lesson.content}\n`;
                if (lesson.homework) {
                    message += `üìå Devoirs: ${lesson.homework}\n`;
                }
                if (lesson.dueDate) {
                    message += `‚è∞ √Ä rendre pour le: ${formatDate(lesson.dueDate)}\n`;
                }
                message += "\n‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï\n\n";
            });

            // Encoder le message pour l'URL
            const encodedMessage = encodeURIComponent(message);
            
            // Num√©ro WhatsApp (92871605)
            const phoneNumber = "92871605";
            
            // Cr√©er le lien WhatsApp
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            // Ouvrir dans un nouvel onglet
            window.open(whatsappUrl, '_blank');
        }

        // Fonctions utilitaires
        function formatDate(dateString) {
            if (!dateString) return '';
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('fr-FR', options);
        }
        
        function getSubjectName(subjectCode) {
            const subjects = {
                'math': 'Math√©matiques',
                'french': 'Fran√ßais',
                'history': 'Histoire-G√©ographie',
                'science': 'Sciences',
                'english': 'Anglais',
                'art': 'Arts Plastiques',
                'pe': '√âducation Physique',
                'other': 'Autre'
            };
            return subjects[subjectCode] || subjectCode;
        }
        
        function getClassName(classCode) {
            const classes = {
                '6eme': '6√®me',
                '5eme': '5√®me',
                '4eme': '4√®me',
                '3eme': '3√®me',
                '2nde': 'Seconde',
                '1ere': 'Premi√®re',
                'terminale': 'Terminale'
            };
            return classes[classCode] || classCode;
        }
        
        function getStatusName(statusCode) {
            const statuses = {
                'present': 'Pr√©sent(e)',
                'absent': 'Absent(e)',
                'late': 'En retard'
            };
            return statuses[statusCode] || statusCode;
        }
        
        function alert(message, title = 'Information') {
            const alertBox = document.createElement('div');
            alertBox.style.position = 'fixed';
            alertBox.style.top = '50%';
            alertBox.style.left = '50%';
            alertBox.style.transform = 'translate(-50%, -50%)';
            alertBox.style.backgroundColor = 'white';
            alertBox.style.padding = '20px';
            alertBox.style.borderRadius = '5px';
            alertBox.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
            alertBox.style.zIndex = '1000';
            alertBox.style.maxWidth = '80%';
            alertBox.style.maxHeight = '80%';
            alertBox.style.overflow = 'auto';
            
            alertBox.innerHTML = `
                <h2 style="margin-top: 0;">${title}</h2>
                <div>${message}</div>
                <button style="margin-top: 15px; padding: 5px 10px;" onclick="this.parentElement.remove()">Fermer</button>
            `;
            
            document.body.appendChild(alertBox);
        }
    </script>
</body>
</html>