<!DOCTYPE html>
<html lang="fr">
     <style>
  .btn-retour {
    padding: 8px 16px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }
  .btn-retour:hover {
    background-color: #e0e0e0;
  }
</style>

<button class="btn-retour" onclick="history.back()">← Retour</button>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Système de Gestion Scolaire - Togo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: #006400;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .logo-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: #daa520;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #006400;
        }
        
        .school-info {
            text-align: center;
            flex-grow: 1;
            padding: 0 20px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        h2 {
            font-size: 20px;
            color: #006400;
            margin: 20px 0 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #006400;
        }
        
        h3 {
            font-size: 18px;
            color: #006400;
            margin: 15px 0 10px;
        }
        
        .form-section {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px 15px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
            padding: 0 10px;
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #006400;
            box-shadow: 0 0 5px rgba(0, 100, 0, 0.3);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }
        
        .btn {
            background: #006400;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #004d00;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            flex-wrap: wrap;
        }
        
        .discipline-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .discipline-name {
            flex: 2;
            min-width: 150px;
        }
        
        .discipline-field {
            flex: 1;
            min-width: 80px;
            margin: 0 5px;
        }
        
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        
        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .checkbox-group {
            display: flex;
            gap: 15px;
            margin: 10px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .results-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .result-item {
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #006400;
        }
        
        .result-value {
            font-size: 18px;
            font-weight: bold;
            color: #006400;
        }
        
        .student-list {
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .student-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .student-item:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .student-info {
            display: flex;
            gap: 15px;
        }
        
        .student-actions {
            display: flex;
            gap: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #666;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .tab.active {
            border-bottom: 3px solid #006400;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Styles du bulletin */
        .bulletin-container {
            width: 21cm;
            min-height: 29.7cm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 1.5cm;
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }
        
        .ministry {
            font-size: 14px;
            font-weight: bold;
        }
        
        .direction {
            font-size: 13px;
            margin: 5px 0;
        }
        
        .title {
            font-size: 16px;
            font-weight: bold;
            text-decoration: underline;
            margin: 10px 0;
        }
        
        .republic {
            font-size: 14px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .motto {
            font-size: 12px;
            font-style: italic;
        }
        
        .school-year {
            font-size: 13px;
            margin: 5px 0;
        }
        
        .school-info {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            font-size: 12px;
        }
        
        .student-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
            font-size: 12px;
        }
        
        .info-item {
            margin-bottom: 5px;
        }
        
        .info-label {
            font-weight: bold;
        }
        
        .discipline-name {
            text-align: left;
            font-weight: bold;
        }
        
        .summary {
            font-weight: bold;
            background-color: #e6e6e6;
        }
        
        .bilan {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
            font-size: 12px;
        }
        
        .bilan-section {
            border: 1px solid #000;
            padding: 10px;
        }
        
        .bilan-title {
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            text-decoration: underline;
        }
        
        .mentions {
            margin: 20px 0;
            font-size: 12px;
        }
        
        .mentions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .mentions-section {
            border: 1px solid #000;
            padding: 10px;
        }
        
        .mentions-title {
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .appreciation {
            margin: 20px 0;
            font-size: 12px;
        }
        
        .appreciation-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .recap {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
            font-size: 12px;
        }
        
        .recap-section {
            border: 1px solid #000;
            padding: 10px;
        }
        
        .recap-title {
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            font-size: 12px;
        }
        
        .signature {
            text-align: center;
            width: 45%;
        }
        
        .signature-line {
            border-top: 1px solid #000;
            margin-top: 40px;
            padding-top: 5px;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 10px;
            border-top: 1px solid #000;
            padding-top: 5px;
        }
        
        .checkbox {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 1px solid #000;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .checked {
            background-color: #000;
        }
        
        /* Styles pour les notes des élèves */
        .student-grades {
            margin-top: 20px;
        }
        
        .student-grade-row {
            display: flex;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f0f8ff;
            border-radius: 5px;
            align-items: center;
        }
        
        .student-grade-name {
            flex: 2;
            margin-right: 10px;
        }
        
        .student-grade-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .calc-buttons {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .results-table th, .results-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .results-table th {
            background-color: #4CAF50;
            color: white;
        }
        
        .highlight {
            background-color: #fffacd;
            font-weight: bold;
        }
        
        .rank-cell {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .subject-notes {
            display: flex;
            gap: 10px;
        }
        
        .note-input {
            width: 60px;
        }
        
        .subject-average {
            font-weight: bold;
            color: #2c3e50;
            margin-left: 10px;
        }
        
        .automatic-calculation {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }
        
        .calculation-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .calculation-info i {
            color: #4caf50;
            font-size: 20px;
        }
        
        /* Nouveaux styles pour les informations supplémentaires */
        .student-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .student-detail-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #006400;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            border-left: 4px solid #006400;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #006400;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        /* Nouveaux styles pour les filtres */
        .filters {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-label {
            font-weight: 600;
            min-width: 100px;
        }
        
        .bulletin-list {
            margin: 20px 0;
        }
        
        .bulletin-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .bulletin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .bulletin-title {
            font-weight: bold;
            font-size: 16px;
        }
        
        .bulletin-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .bulletin-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Nouveaux styles pour l'aperçu des bulletins */
        .bulletin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .bulletin-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 15px;
            transition: transform 0.3s ease;
        }
        
        .bulletin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .bulletin-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        
        .bulletin-title {
            font-weight: bold;
            font-size: 16px;
            color: #006400;
        }
        
        .bulletin-details {
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .bulletin-stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 18px;
            color: #006400;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .bulletin-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .view-all-container {
            text-align: center;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .form-group {
                min-width: 100%;
            }
            
            .grid-3, .results-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .discipline-field {
                min-width: 60px;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .student-info {
                flex-direction: column;
                gap: 5px;
            }
            
            .student-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .bulletin-container {
                width: 100%;
                padding: 1cm;
            }
            
            .student-info {
                grid-template-columns: 1fr;
            }
            
            .bilan, .recap, .mentions-grid {
                grid-template-columns: 1fr;
            }
            
            .student-details {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .bulletin-details {
                grid-template-columns: 1fr;
            }
            
            .bulletin-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
        
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 0;
            }
            
            .bulletin-container {
                box-shadow: none;
                padding: 1cm;
                width: 100%;
            }
            
            .no-print {
                display: none !important;
            }
            
            .bulletin {
                display: block !important;
                border: none;
                padding: 0;
            }
            
            .tabs, .actions, .filters {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-section">
                <div class="logo">RT</div>
                <div class="school-info">
                    <h1>RÉPUBLIQUE TOGOLAISE</h1>
                    <p>Travail - Liberté - Patrie</p>
                    <p>Ministère des Enseignements Primaire, Secondaire et Technique</p>
                    <p>Inspection de l'Enseignement Secondaire Général - Kara</p>
                </div>
                <div class="logo">EDS</div>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">Gestion de la Classe</div>
            <div class="tab" onclick="switchTab(1)">Saisie des Notes</div>
            <div class="tab" onclick="switchTab(2)">Notes des Élèves</div>
            <div class="tab" onclick="switchTab(3)">Résultats</div>
            <div class="tab" onclick="switchTab(4)">Aperçu Bulletin</div>
            <div class="tab" onclick="switchTab(5)">Bulletins Enregistrés</div>
            <div class="tab" onclick="switchTab(6)">Tous les Bulletins</div>
        </div>

        <form id="bulletinForm">
            <!-- Onglet 1: Gestion de la classe -->
            <div class="tab-content active">
                <div class="form-section">
                    <h2>Informations de la Classe</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="niveau">Niveau d'enseignement</label>
                            <select id="niveau" required onchange="updateMatieres()">
                                <option value="">Sélectionner un niveau</option>
                                <option value="college">Collège</option>
                                <option value="lycee">Lycée</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="classe">Classe</label>
                            <select id="classe" required onchange="updateMatieres()">
                                <option value="">Sélectionner une classe</option>
                                <option value="6e">6ème</option>
                                <option value="5e">5ème</option>
                                <option value="4e">4ème</option>
                                <option value="3e">3ème</option>
                                <option value="2nd">Seconde</option>
                                <option value="1ere">Première</option>
                                <option value="tle">Terminale</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="serie">Série (Lycée)</label>
                            <select id="serie" onchange="updateMatieres()">
                                <option value="">Sélectionner une série</option>
                                <option value="A">Série A</option>
                                <option value="C">Série C</option>
                                <option value="D">Série D</option>
                                <option value="E">Série E</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inspection">Inspection de l'Enseignement</label>
                            <input type="text" id="inspection" value="IESG-Niamtougou" readonly>
                        </div>
                        <div class="form-group">
                            <label for="direction">Direction Régionale</label>
                            <input type="text" id="direction" value="DRE-KARA" readonly>
                        </div>
                        <div class="form-group">
                            <label for="anneeScolaire">Année Scolaire</label>
                            <input type="text" id="anneeScolaire" placeholder="Ex: 2025-2026" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="periode">Période</label>
                            <select id="periode" required>
                                <option value="">Sélectionner une période</option>
                                <option value="1">1er Trimestre</option>
                                <option value="2">2ème Trimestre</option>
                                <option value="3">3ème Trimestre</option>
                                <option value="4">1er Semestre</option>
                                <option value="5">2ème Semestre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dateEdition">Date d'édition</label>
                            <input type="date" id="dateEdition" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Information de l'Établissement</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="etablissement">Nom de l'Établissement</label>
                            <input type="text" id="etablissement" placeholder="Ex: CEG MASSEDENA" required>
                        </div>
                        <div class="form-group">
                            <label for="codeEtablissement">Code Établissement</label>
                            <input type="text" id="codeEtablissement" placeholder="Ex: 000123">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="statut">Statut</label>
                            <select id="statut">
                                <option value="Public">Public</option>
                                <option value="Privé">Privé</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ville">Ville</label>
                            <input type="text" id="ville" value="KARA">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Gestion des Élèves</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nomEleve">Nom</label>
                            <input type="text" id="nomEleve" placeholder="Nom de l'élève">
                        </div>
                        <div class="form-group">
                            <label for="prenomEleve">Prénom</label>
                            <input type="text" id="prenomEleve" placeholder="Prénom de l'élève">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="matricule">Matricule</label>
                            <input type="text" id="matricule" placeholder="Matricule de l'élève">
                        </div>
                        <div class="form-group">
                            <label for="sexe">Sexe</label>
                            <select id="sexe">
                                <option value="">Sélectionner</option>
                                <option value="M">Masculin</option>
                                <option value="F">Féminin</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dateNaissance">Date de naissance</label>
                            <input type="date" id="dateNaissance">
                        </div>
                        <div class="form-group">
                            <label for="lieuNaissance">Lieu de naissance</label>
                            <input type="text" id="lieuNaissance" placeholder="Lieu de naissance">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="statutEleve">Statut de l'élève</label>
                            <select id="statutEleve">
                                <option value="Nouveau">Nouveau</option>
                                 <option value="Nouvelle">Nouvelle</option>
                                <option value="Redoublant">Redoublant</option>
                                <option value="Redoublante">Redoublante</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="effectif">Effectif de la classe</label>
                            <input type="number" id="effectif" min="1" required onchange="updateStudentGrades()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <button type="button" class="btn btn-success" onclick="ajouterEleve()">
                                <i class="fas fa-plus"></i> Ajouter un élève
                            </button>
                        </div>
                    </div>

                    <h3>Liste des élèves</h3>
                    <div class="student-list" id="listeEleves">
                        <!-- Les élèves seront ajoutés ici dynamiquement -->
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <button type="button" class="btn" onclick="chargerMatieresParDefaut()">
                            <i class="fas fa-book"></i> Charger les matières par défaut
                        </button>
                    </div>
                </div>
            </div>

            <!-- Onglet 2: Saisie des notes -->
            <div class="tab-content">
                <div class="form-section">
                    <h2>Saisie des Notes</h2>
                    
                    <div class="automatic-calculation">
                        <div class="calculation-info">
                            <i class="fas fa-calculator"></i>
                            <span>Le calcul des moyennes et des rangs se fait automatiquement à chaque modification</span>
                        </div>
                        <p>Les moyennes sont calculées selon la formule : (Note 1 + Note 2) / 2</p>
                        <p>Les rangs sont déterminés automatiquement en fonction des moyennes générales</p>
                    </div>
                    
                    <div id="disciplinesContainer">
                        <!-- En-tête du tableau -->
                        <div class="discipline-row" style="font-weight: bold;">
                            <div class="discipline-name">Discipline</div>
                            <div class="discipline-field">Coefficient</div>
                            <div class="discipline-field">Note 1</div>
                            <div class="discipline-field">Note 2</div>
                            <div class="discipline-field">Moyenne</div>
                            <div class="discipline-field">Enseignant</div>
                            <div style="width: 40px;">Action</div>
                        </div>
                    </div>
                    
                    <button type="button" class="add-btn" id="addDiscipline">
                        <i class="fas fa-plus"></i> Ajouter une discipline
                    </button>
                </div>

                <div class="form-section">
                    <h2>Saisie pour un élève spécifique</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eleveSelect">Sélectionner un élève</label>
                            <select id="eleveSelect" onchange="chargerNotesEleve()">
                                <option value="">Sélectionner un élève</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet 3: Notes des élèves -->
            <div class="tab-content">
                <div class="form-section">
                    <h2>Notes des Élèves de la Classe</h2>
                    
                    <div class="automatic-calculation">
                        <div class="calculation-info">
                            <i class="fas fa-robot"></i>
                            <span>Le système calcule automatiquement les moyennes et les rangs</span>
                        </div>
                        <p>Modifiez les notes pour voir les calculs se mettre à jour en temps réel</p>
                    </div>
                    
                    <div id="studentGradesContainer" class="student-grades">
                        <!-- Les notes des élèves seront générées ici -->
                    </div>
                    
                    <h3>Résultats de la Classe</h3>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Matière</th>
                                <th>Moyenne Classe</th>
                                <th>Note Min</th>
                                <th>Note Max</th>
                            </tr>
                        </thead>
                        <tbody id="classResults">
                            <!-- Les résultats par matière seront affichés ici -->
                        </tbody>
                    </table>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="totalAbsences">Total d'heures d'absence</label>
                            <input type="number" id="totalAbsences" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="justifiedAbsences">Heures justifiées</label>
                            <input type="number" id="justifiedAbsences" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="unjustifiedAbsences">Heures non justifiées</label>
                            <input type="number" id="unjustifiedAbsences" min="0" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet 4: Résultats -->
            <div class="tab-content">
                <div class="form-section">
                    <h2>Résultats de la Classe</h2>
                    
                    <div class="automatic-calculation">
                        <div class="calculation-info">
                            <i class="fas fa-chart-line"></i>
                            <span>Résultats calculés automatiquement à partir des notes saisies</span>
                        </div>
                    </div>
                    
                    <div class="results-section">
                        <h3>Statistiques de la classe</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="moyenneClasse">0.00</div>
                                <div class="stat-label">Moyenne de la classe</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="moyenneMax">0.00</div>
                                <div class="stat-label">Moyenne la plus élevée</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="moyenneMin">0.00</div>
                                <div class="stat-label">Moyenne la plus basse</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="nbEleves">0</div>
                                <div class="stat-label">Nombre d'élèves</div>
                            </div>
                        </div>
                    </div>

                    <h3>Classement des élèves</h3>
                    <table id="tableauClassement">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>Nom et Prénom</th>
                                <th>Moyenne</th>
                                <th>Mention</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Le classement sera généré ici -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Onglet 5: Aperçu Bulletin -->
            <div class="tab-content">
                <div class="form-section">
                    <h2>Aperçu du Bulletin</h2>
                    
                    <div class="actions">
                        <button type="button" class="btn" onclick="genererBulletin()">
                            <i class="fas fa-sync"></i> Générer le bulletin
                        </button>
                        <button type="button" class="btn btn-info" onclick="printBulletin()">
                            <i class="fas fa-print"></i> Imprimer le bulletin
                        </button>
                    </div>
                    
                    <div id="bulletinPreview" class="bulletin-container">
                        <!-- L'aperçu du bulletin sera généré ici -->
                    </div>
                </div>
            </div>

            <!-- Onglet 6: Bulletins enregistrés -->
            <div class="tab-content">
                <div class="form-section">
                    <h2>Bulletins Enregistrés</h2>
                    
                    <div class="filters">
                        <h3>Filtres</h3>
                        <div class="filter-row">
                            <div class="filter-group">
                                <span class="filter-label">Classe:</span>
                                <select id="filterClasse" onchange="filterBulletins()">
                                    <option value="all">Toutes les classes</option>
                                    <option value="6e">6ème</option>
                                    <option value="5e">5ème</option>
                                    <option value="4e">4ème</option>
                                    <option value="3e">3ème</option>
                                    <option value="2nd">Seconde</option>
                                    <option value="1ere">Première</option>
                                    <option value="tle">Terminale</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">Élève:</span>
                                <select id="filterEleve" onchange="filterBulletins()">
                                    <option value="all">Tous les élèves</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">Période:</span>
                                <select id="filterPeriode" onchange="filterBulletins()">
                                    <option value="all">Toutes les périodes</option>
                                    <option value="1">1er Trimestre</option>
                                    <option value="2">2ème Trimestre</option>
                                    <option value="3">3ème Trimestre</option>
                                    <option value="4">1er Semestre</option>
                                    <option value="5">2ème Semestre</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <button type="button" class="btn btn-sm" onclick="clearFilters()">
                                    <i class="fas fa-times"></i> Effacer les filtres
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bulletin-list" id="bulletinList">
                        <!-- La liste des bulletins sera générée ici -->
                    </div>
                </div>
            </div>

            <!-- Nouvel onglet 7: Tous les bulletins -->
            <div class="tab-content">
                <div class="form-section">
                    <h2>Aperçu de Tous les Bulletins</h2>
                    
                    <div class="filters">
                        <h3>Filtres</h3>
                        <div class="filter-row">
                            <div class="filter-group">
                                <span class="filter-label">Classe:</span>
                                <select id="allFilterClasse" onchange="filterAllBulletins()">
                                    <option value="all">Toutes les classes</option>
                                    <option value="6e">6ème</option>
                                    <option value="5e">5ème</option>
                                    <option value="4e">4ème</option>
                                    <option value="3e">3ème</option>
                                    <option value="2nd">Seconde</option>
                                    <option value="1ere">Première</option>
                                    <option value="tle">Terminale</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">Période:</span>
                                <select id="allFilterPeriode" onchange="filterAllBulletins()">
                                    <option value="all">Toutes les périodes</option>
                                    <option value="1">1er Trimestre</option>
                                    <option value="2">2ème Trimestre</option>
                                    <option value="3">3ème Trimestre</option>
                                    <option value="4">1er Semestre</option>
                                    <option value="5">2ème Semestre</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">Année scolaire:</span>
                                <select id="allFilterAnnee" onchange="filterAllBulletins()">
                                    <option value="all">Toutes les années</option>
                                    <!-- Les options seront ajoutées dynamiquement -->
                                </select>
                            </div>
                            <div class="filter-group">
                                <button type="button" class="btn btn-sm" onclick="clearAllFilters()">
                                    <i class="fas fa-times"></i> Effacer les filtres
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="view-all-container">
                        <button type="button" class="btn btn-info" onclick="loadAllBulletins()">
                            <i class="fas fa-sync"></i> Actualiser la liste
                        </button>
                    </div>
                    
                    <div id="allBulletinsContainer" class="bulletin-grid">
                        <!-- Tous les bulletins seront affichés ici -->
                    </div>
                </div>
            </div>

            <div class="actions">
                <button type="button" class="btn btn-success" onclick="saveData()">
                    <i class="fas fa-save"></i> Sauvegarder
                </button>
                <button type="button" class="btn btn-secondary" onclick="loadData()">
                    <i class="fas fa-folder-open"></i> Charger
                </button>
                <button type="button" class="btn btn-info" onclick="calculateAll()">
                    <i class="fas fa-calculator"></i> Calculer les résultats
                </button>
                <button type="reset" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Réinitialiser
                </button>
            </div>
        </form>

        <footer>
            <p>Ministère des Enseignements Primaire, Secondaire et Technique - République Togolaise</p>
            <p>© 2025 - Tous droits réservés</p>
        </footer>
    </div>

    <script>
        // Variables globales
        let eleves = [];
        let disciplines = [];
        let notes = {};
        let classement = [];
        let currentStudentId = null;
        let savedBulletins = [];

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser la date d'édition à aujourd'hui
            document.getElementById('dateEdition').valueAsDate = new Date();
            
            // Charger les données sauvegardées si elles existent
            loadData();
            
            // Mettre à jour les matières en fonction du niveau sélectionné
            updateMatieres();
            
            // Ajouter des écouteurs d'événements pour les champs de notes
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('note-input')) {
                    calculateStudentAverage(e.target.dataset.studentId);
                    calculateClassResults();
                }
            });
            
            // Initialiser l'écouteur pour ajouter des disciplines
            document.getElementById('addDiscipline').addEventListener('click', function() {
                disciplines.push({ nom: 'Nouvelle Discipline', coefficient: 1 });
                updateDisciplines();
            });
        });

        // Fonction pour sauvegarder les données
        function saveData() {
            const data = {
                eleves: eleves,
                disciplines: disciplines,
                notes: notes,
                classement: classement,
                classe: document.getElementById('classe').value,
                niveau: document.getElementById('niveau').value,
                serie: document.getElementById('serie').value,
                anneeScolaire: document.getElementById('anneeScolaire').value,
                periode: document.getElementById('periode').value,
                etablissement: document.getElementById('etablissement').value,
                codeEtablissement: document.getElementById('codeEtablissement').value
            };
            
            localStorage.setItem('bulletinData', JSON.stringify(data));
            
            // Sauvegarder également le bulletin actuel
            saveCurrentBulletin();
            
            alert('Données sauvegardées avec succès!');
        }

        // Fonction pour sauvegarder le bulletin actuel
        function saveCurrentBulletin() {
            const bulletinData = {
                id: Date.now(),
                date: new Date().toLocaleDateString('fr-FR'),
                classe: document.getElementById('classe').value,
                niveau: document.getElementById('niveau').value,
                periode: document.getElementById('periode').value,
                anneeScolaire: document.getElementById('anneeScolaire').value,
                etablissement: document.getElementById('etablissement').value,
                eleves: eleves.map(eleve => {
                    return {
                        id: eleve.id,
                        nom: eleve.nom,
                        prenom: eleve.prenom,
                        matricule: eleve.matricule,
                        moyenne: notes[eleve.id]?.moyenneGenerale || 0,
                        rang: classement.find(c => c.id === eleve.id)?.rang || 0
                    };
                })
            };
            
            // Charger les bulletins existants
            const existingBulletins = JSON.parse(localStorage.getItem('savedBulletins') || '[]');
            
            // Vérifier si un bulletin similaire existe déjà
            const existingIndex = existingBulletins.findIndex(b => 
                b.classe === bulletinData.classe && 
                b.periode === bulletinData.periode && 
                b.anneeScolaire === bulletinData.anneeScolaire
            );
            
            if (existingIndex !== -1) {
                // Mettre à jour le bulletin existant
                existingBulletins[existingIndex] = bulletinData;
            } else {
                // Ajouter le nouveau bulletin
                existingBulletins.push(bulletinData);
            }
            
            // Sauvegarder les bulletins
            localStorage.setItem('savedBulletins', JSON.stringify(existingBulletins));
            
            // Mettre à jour l'affichage des bulletins
            displaySavedBulletins();
        }

        // Fonction pour afficher les bulletins enregistrés
        function displaySavedBulletins() {
            const bulletinList = document.getElementById('bulletinList');
            bulletinList.innerHTML = '';
            
            const savedBulletins = JSON.parse(localStorage.getItem('savedBulletins') || '[]');
            
            if (savedBulletins.length === 0) {
                bulletinList.innerHTML = '<p>Aucun bulletin enregistré.</p>';
                return;
            }
            
            // Appliquer les filtres
            const classeFilter = document.getElementById('filterClasse').value;
            const eleveFilter = document.getElementById('filterEleve').value;
            const periodeFilter = document.getElementById('filterPeriode').value;
            
            const filteredBulletins = savedBulletins.filter(bulletin => {
                if (classeFilter !== 'all' && bulletin.classe !== classeFilter) return false;
                if (periodeFilter !== 'all' && bulletin.periode !== periodeFilter) return false;
                return true;
            });
            
            filteredBulletins.forEach(bulletin => {
                const bulletinItem = document.createElement('div');
                bulletinItem.className = 'bulletin-item';
                
                bulletinItem.innerHTML = `
                    <div class="bulletin-header">
                        <div class="bulletin-title">Bulletin - ${bulletin.classe} - ${getPeriodeText(bulletin.periode)} ${bulletin.anneeScolaire}</div>
                        <div class="bulletin-date">${bulletin.date}</div>
                    </div>
                    <div class="bulletin-details">
                        <div><strong>Établissement:</strong> ${bulletin.etablissement}</div>
                        <div><strong>Classe:</strong> ${bulletin.classe}</div>
                        <div><strong>Période:</strong> ${getPeriodeText(bulletin.periode)}</div>
                        <div><strong>Année scolaire:</strong> ${bulletin.anneeScolaire}</div>
                    </div>
                    <div class="bulletin-actions">
                        <button type="button" class="btn btn-sm btn-info" onclick="loadBulletin(${bulletin.id})">
                            <i class="fas fa-eye"></i> Voir
                        </button>
                        <button type="button" class="btn btn-sm btn-success" onclick="printBulletinById(${bulletin.id})">
                            <i class="fas fa-print"></i> Imprimer
                        </button>
                        <button type="button" class="btn btn-sm btn-danger" onclick="deleteBulletin(${bulletin.id})">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                `;
                
                bulletinList.appendChild(bulletinItem);
            });
        }

        // Fonction pour charger les données
        function loadData() {
            const savedData = localStorage.getItem('bulletinData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                eleves = data.eleves || [];
                disciplines = data.disciplines || [];
                notes = data.notes || {};
                classement = data.classement || [];
                
                // Mettre à jour les champs du formulaire
                if (data.classe) document.getElementById('classe').value = data.classe;
                if (data.niveau) document.getElementById('niveau').value = data.niveau;
                if (data.serie) document.getElementById('serie').value = data.serie;
                if (data.anneeScolaire) document.getElementById('anneeScolaire').value = data.anneeScolaire;
                if (data.periode) document.getElementById('periode').value = data.periode;
                if (data.etablissement) document.getElementById('etablissement').value = data.etablissement;
                if (data.codeEtablissement) document.getElementById('codeEtablissement').value = data.codeEtablissement;
                
                // Mettre à jour l'affichage
                updateEleveList();
                updateDisciplines();
                updateStudentGrades();
                calculateAll();
                updateEleveFilters();
                
                alert('Données chargées avec succès!');
            } else {
                alert('Aucune donnée sauvegardée trouvée.');
            }
            
            // Charger et afficher les bulletins enregistrés
            displaySavedBulletins();
        }

        // Fonction pour mettre à jour les filtres d'élèves
        function updateEleveFilters() {
            const filterEleve = document.getElementById('filterEleve');
            
            if (filterEleve) {
                // Sauvegarder la valeur actuelle
                const currentValue = filterEleve.value;
                
                // Mettre à jour les options
                filterEleve.innerHTML = '<option value="all">Tous les élèves</option>';
                
                eleves.forEach(eleve => {
                    const option = document.createElement('option');
                    option.value = eleve.id;
                    option.textContent = `${eleve.nom} ${eleve.prenom}`;
                    filterEleve.appendChild(option);
                });
                
                // Restaurer la valeur précédente si elle existe toujours
                if (currentValue && Array.from(filterEleve.options).some(opt => opt.value === currentValue)) {
                    filterEleve.value = currentValue;
                }
            }
        }

        // Fonction pour filtrer les bulletins
        function filterBulletins() {
            displaySavedBulletins();
        }

        // Fonction pour effacer les filtres
        function clearFilters() {
            document.getElementById('filterClasse').value = 'all';
            document.getElementById('filterEleve').value = 'all';
            document.getElementById('filterPeriode').value = 'all';
            displaySavedBulletins();
        }

        // Fonction pour charger un bulletin spécifique
        function loadBulletin(bulletinId) {
            const savedBulletins = JSON.parse(localStorage.getItem('savedBulletins') || '[]');
            const bulletin = savedBulletins.find(b => b.id === bulletinId);
            
            if (bulletin) {
                // Charger les données du bulletin
                document.getElementById('classe').value = bulletin.classe;
                document.getElementById('niveau').value = bulletin.niveau;
                document.getElementById('periode').value = bulletin.periode;
                document.getElementById('anneeScolaire').value = bulletin.anneeScolaire;
                document.getElementById('etablissement').value = bulletin.etablissement;
                
                // Basculer vers l'onglet de gestion de classe
                switchTab(0);
                
                alert('Bulletin chargé avec succès!');
            } else {
                alert('Bulletin non trouvé!');
            }
        }

        // Fonction pour imprimer un bulletin spécifique
        function printBulletinById(bulletinId) {
            const savedBulletins = JSON.parse(localStorage.getItem('savedBulletins') || '[]');
            const bulletin = savedBulletins.find(b => b.id === bulletinId);
            
            if (bulletin) {
                // Générer le bulletin
                genererBulletin();
                
                // Attendre un peu pour que le bulletin soit généré puis l'imprimer
                setTimeout(() => {
                    window.print();
                }, 500);
            } else {
                alert('Bulletin non trouvé!');
            }
        }

        // Fonction pour supprimer un bulletin
        function deleteBulletin(bulletinId) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce bulletin ?')) {
                const savedBulletins = JSON.parse(localStorage.getItem('savedBulletins') || '[]');
                const filteredBulletins = savedBulletins.filter(b => b.id !== bulletinId);
                
                localStorage.setItem('savedBulletins', JSON.stringify(filteredBulletins));
                
                // Mettre à jour l'affichage
                displaySavedBulletins();
                
                alert('Bulletin supprimé avec succès!');
            }
        }

        // Fonction pour ajouter un élève
        function ajouterEleve() {
            const nom = document.getElementById('nomEleve').value.trim();
            const prenom = document.getElementById('prenomEleve').value.trim();
            const matricule = document.getElementById('matricule').value.trim();
            const sexe = document.getElementById('sexe').value;
            const dateNaissance = document.getElementById('dateNaissance').value;
            const lieuNaissance = document.getElementById('lieuNaissance').value.trim();
            const statutEleve = document.getElementById('statutEleve').value;
            
            if (!nom || !prenom) {
                alert('Veuillez saisir le nom et le prénom de l\'élève.');
                return;
            }
            
            const id = Date.now().toString();
            const eleve = {
                id: id,
                nom: nom,
                prenom: prenom,
                matricule: matricule,
                sexe: sexe,
                dateNaissance: dateNaissance,
                lieuNaissance: lieuNaissance,
                statutEleve: statutEleve,
                classe: document.getElementById('classe').value
            };
            
            eleves.push(eleve);
            notes[id] = {};
            
            // Réinitialiser les champs
            document.getElementById('nomEleve').value = '';
            document.getElementById('prenomEleve').value = '';
            document.getElementById('matricule').value = '';
            document.getElementById('sexe').value = '';
            document.getElementById('dateNaissance').value = '';
            document.getElementById('lieuNaissance').value = '';
            document.getElementById('statutEleve').value = 'Nouveau';
            
            // Mettre à jour l'affichage
            updateEleveList();
            updateEleveSelect();
            updateStudentGrades();
            updateEleveFilters();
            
            // Recalculer les résultats
            calculateAll();
        }

        // Fonction pour mettre à jour la liste des élèves
        function updateEleveList() {
            const listeEleves = document.getElementById('listeEleves');
            listeEleves.innerHTML = '';
            
            eleves.forEach(eleve => {
                const div = document.createElement('div');
                div.className = 'student-item';
                div.innerHTML = `
                    <div class="student-info">
                        <span>${eleve.nom} ${eleve.prenom}</span>
                        <span>${eleve.matricule ? '(' + eleve.matricule + ')' : ''}</span>
                        <span>${eleve.sexe ? eleve.sexe === 'M' ? '(M)' : '(F)' : ''}</span>
                    </div>
                    <div class="student-actions">
                        <button type="button" class="btn btn-sm btn-info" onclick="chargerNotesEleve('${eleve.id}')">
                            <i class="fas fa-edit"></i> Notes
                        </button>
                        <button type="button" class="btn btn-sm btn-danger" onclick="supprimerEleve('${eleve.id}')">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                `;
                listeEleves.appendChild(div);
            });
        }

        // Fonction pour supprimer un élève
        function supprimerEleve(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet élève ?')) {
                eleves = eleves.filter(e => e.id !== id);
                delete notes[id];
                
                updateEleveList();
                updateEleveSelect();
                updateStudentGrades();
                updateEleveFilters();
                calculateAll();
            }
        }

        // Fonction pour mettre à jour le sélecteur d'élèves
        function updateEleveSelect() {
            const eleveSelect = document.getElementById('eleveSelect');
            eleveSelect.innerHTML = '<option value="">Sélectionner un élève</option>';
            
            eleves.forEach(eleve => {
                const option = document.createElement('option');
                option.value = eleve.id;
                option.textContent = `${eleve.nom} ${eleve.prenom}`;
                eleveSelect.appendChild(option);
            });
        }

        // Fonction pour charger les notes d'un élève
        function chargerNotesEleve(id = null) {
            if (!id) {
                id = document.getElementById('eleveSelect').value;
            }
            
            if (!id) return;
            
            currentStudentId = id;
            
            // Mettre à jour le sélecteur d'élèves
            document.getElementById('eleveSelect').value = id;
            
            // Charger les notes de l'élève
            if (!notes[id]) {
                notes[id] = {};
            }
            
            // Mettre à jour les champs de notes
            disciplines.forEach(discipline => {
                const note1Input = document.querySelector(`.note-input[data-student-id="${id}"][data-discipline="${discipline.nom}"][data-type="note1"]`);
                const note2Input = document.querySelector(`.note-input[data-student-id="${id}"][data-discipline="${discipline.nom}"][data-type="note2"]`);
                
                if (note1Input && notes[id][discipline.nom]) {
                    note1Input.value = notes[id][discipline.nom].note1 || '';
                }
                
                if (note2Input && notes[id][discipline.nom]) {
                    note2Input.value = notes[id][discipline.nom].note2 || '';
                }
            });
            
            // Calculer la moyenne de l'élève
            calculateStudentAverage(id);
        }

        // Fonction pour calculer la moyenne d'un élève
        function calculateStudentAverage(studentId) {
            if (!notes[studentId]) return 0;
            
            let totalPoints = 0;
            let totalCoefficients = 0;
            
            disciplines.forEach(discipline => {
                if (notes[studentId][discipline.nom]) {
                    const note1 = parseFloat(notes[studentId][discipline.nom].note1) || 0;
                    const note2 = parseFloat(notes[studentId][discipline.nom].note2) || 0;
                    const coefficient = parseFloat(discipline.coefficient) || 1;
                    
                    // Calculer la moyenne de la discipline
                    const moyenneDiscipline = (note1 + note2) / 2;
                    
                    // Ajouter au total pondéré
                    totalPoints += moyenneDiscipline * coefficient;
                    totalCoefficients += coefficient;
                    
                    // Mettre à jour l'affichage de la moyenne de la discipline
                    const moyenneElement = document.querySelector(`.student-average[data-student-id="${studentId}"][data-discipline="${discipline.nom}"]`);
                    if (moyenneElement) {
                        moyenneElement.textContent = moyenneDiscipline.toFixed(2);
                    }
                }
            });
            
            // Calculer la moyenne générale
            const moyenneGenerale = totalCoefficients > 0 ? totalPoints / totalCoefficients : 0;
            
            // Mettre à jour l'affichage de la moyenne générale
            const moyenneGeneraleElement = document.querySelector(`.student-total-average[data-student-id="${studentId}"]`);
            if (moyenneGeneraleElement) {
                moyenneGeneraleElement.textContent = moyenneGenerale.toFixed(2);
            }
            
            // Mettre à jour les données
            if (!notes[studentId]) notes[studentId] = {};
            notes[studentId].moyenneGenerale = moyenneGenerale;
            
            return moyenneGenerale;
        }

        // Fonction pour calculer tous les résultats
        function calculateAll() {
            // Calculer les moyennes de tous les élèves
            eleves.forEach(eleve => {
                calculateStudentAverage(eleve.id);
            });
            
            // Calculer le classement
            calculateRanking();
            
            // Calculer les résultats de la classe
            calculateClassResults();
            
            // Générer le bulletin
            genererBulletin();
        }

        // Fonction pour calculer le classement
        function calculateRanking() {
            // Préparer les données pour le classement
            classement = eleves.map(eleve => {
                return {
                    id: eleve.id,
                    nom: eleve.nom,
                    prenom: eleve.prenom,
                    moyenne: notes[eleve.id]?.moyenneGenerale || 0
                };
            });
            
            // Trier par moyenne décroissante
            classement.sort((a, b) => b.moyenne - a.moyenne);
            
            // Assigner les rangs (gérer les ex-aequo)
            let rang = 1;
            for (let i = 0; i < classement.length; i++) {
                if (i > 0 && classement[i].moyenne < classement[i-1].moyenne) {
                    rang = i + 1;
                }
                classement[i].rang = rang;
                
                // Déterminer la mention
                classement[i].mention = getMention(classement[i].moyenne);
            }
            
            // Mettre à jour l'affichage du classement
            updateRankingDisplay();
        }

        // Fonction pour déterminer la mention
        function getMention(moyenne) {
            if (moyenne >= 18) return 'Excellent';
            if (moyenne >= 16) return 'Très Bien';
            if (moyenne >= 14) return 'Bien';
            if (moyenne >= 12) return 'Assez Bien';
            if (moyenne >= 10) return 'Passable';
            return 'Insuffisant';
        }

        // Fonction pour mettre à jour l'affichage du classement
        function updateRankingDisplay() {
            const tbody = document.querySelector('#tableauClassement tbody');
            tbody.innerHTML = '';
            
            classement.forEach(eleve => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="rank-cell">${eleve.rang}</td>
                    <td>${eleve.nom} ${eleve.prenom}</td>
                    <td>${eleve.moyenne.toFixed(2)}</td>
                    <td>${eleve.mention}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Fonction pour calculer les résultats de la classe
        function calculateClassResults() {
            // Calculer les statistiques par matière
            const results = {};
            
            disciplines.forEach(discipline => {
                results[discipline.nom] = {
                    total: 0,
                    count: 0,
                    min: 0,
                    max: 0
                };
                
                eleves.forEach(eleve => {
                    if (notes[eleve.id] && notes[eleve.id][discipline.nom]) {
                        const note1 = parseFloat(notes[eleve.id][discipline.nom].note1) || 0;
                        const note2 = parseFloat(notes[eleve.id][discipline.nom].note2) || 0;
                        const moyenne = (note1 + note2) / 2;
                        
                        results[discipline.nom].total += moyenne;
                        results[discipline.nom].count++;
                        
                        if (moyenne < results[discipline.nom].min) results[discipline.nom].min = moyenne;
                        if (moyenne > results[discipline.nom].max) results[discipline.nom].max = moyenne;
                    }
                });
            });
            
            // Mettre à jour l'affichage des résultats par matière
            const classResults = document.getElementById('classResults');
            classResults.innerHTML = '';
            
            disciplines.forEach(discipline => {
                const result = results[discipline.nom];
                const moyenneClasse = result.count > 0 ? result.total / result.count : 0;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${discipline.nom}</td>
                    <td>${moyenneClasse.toFixed(2)}</td>
                    <td>${result.min.toFixed(2)}</td>
                    <td>${result.max.toFixed(2)}</td>
                `;
                classResults.appendChild(tr);
            });
            
            // Calculer les statistiques générales de la classe
            let totalMoyenne = 0;
            let minMoyenne = 0;
            let maxMoyenne = 0;
            
            eleves.forEach(eleve => {
                const moyenne = notes[eleve.id]?.moyenneGenerale || 0;
                totalMoyenne += moyenne;
                
                if (moyenne < minMoyenne) minMoyenne = moyenne;
                if (moyenne > maxMoyenne) maxMoyenne = moyenne;
            });
            
            const moyenneClasse = eleves.length > 0 ? totalMoyenne / eleves.length : 0;
            
            // Mettre à jour l'affichage des statistiques générales
            document.getElementById('moyenneClasse').textContent = moyenneClasse.toFixed(2);
            document.getElementById('moyenneMin').textContent = minMoyenne.toFixed(2);
            document.getElementById('moyenneMax').textContent = maxMoyenne.toFixed(2);
            document.getElementById('nbEleves').textContent = eleves.length;
        }

        // Fonction pour mettre à jour les matières en fonction du niveau et de la classe
        function updateMatieres() {
            const niveau = document.getElementById('niveau').value;
            const classe = document.getElementById('classe').value;
            const serie = document.getElementById('serie').value;
            
            // Réinitialiser les disciplines
            disciplines = [];
            
            // Définir les matières par défaut selon le niveau
            if (niveau === 'college') {
                disciplines = [
                    { nom: 'Français', coefficient: 1 },
                    { nom: 'Mathématiques', coefficient: 1 },
                    { nom: 'Histoire-Géographie', coefficient: 1 },
                    { nom: 'SVT', coefficient: 1 },
                    { nom: 'Physique-Chimie', coefficient: 1 },
                    { nom: 'Anglais', coefficient: 1 },
                    { nom: 'EPS', coefficient: 1 },
                    { nom: 'Arts Plastiques', coefficient: 1 }
                ];
            } else if (niveau === 'lycee') {
                // Matières communes pour tous les lycéens
                disciplines = [
                    { nom: 'Français', coefficient: 3 },
                    { nom: 'Philosophie', coefficient: 3 },
                    { nom: 'Histoire-Géographie', coefficient: 2 },
                    { nom: 'LV1 (Anglais)', coefficient: 2 },
                    { nom: 'LV2 (Espagnol)', coefficient: 2 },
                    { nom: 'LV2 (Allemand)', coefficient: 2 },
                    { nom: 'EPS', coefficient: 1 },
                    { nom: 'DESSIN', coefficient: 1 }
                ];
                
                // Ajouter les matières spécifiques selon la série
                if (serie === 'A') {
                    disciplines.push(
                        { nom: 'Français', coefficient: 4 },
                         { nom: 'Anglais', coefficient: 2 },
                         { nom: 'Histoire Geographie', coefficient: 2 },
                         { nom: 'Allemand', coefficient: 4 },
                        { nom: 'Langues Anciennes', coefficient: 3 }
                    );
                } else if (serie === 'C') {
                    disciplines.push(
                        { nom: 'Mathématiques', coefficient: 5 },
                        { nom: 'Physique-Chimie', coefficient: 3 }
                    );
                } else if (serie === 'D') {
                    disciplines.push(
                        { nom: 'Mathématiques', coefficient: 3 },
                        { nom: 'SVT', coefficient: 4 }
                    );
                } else if (serie === 'E') {
                    disciplines.push(
                        { nom: 'Mathématiques', coefficient: 5 },
                        { nom: 'Technologie', coefficient: 4 }
                    );
                }
            }
            
            // Mettre à jour l'affichage des disciplines
            updateDisciplines();
            
            // Mettre à jour les notes des élèves
            updateStudentGrades();
        }

        // Fonction pour charger les matières par défaut
        function chargerMatieresParDefaut() {
            updateMatieres();
            alert('Matières chargées avec succès!');
        }

        // Fonction pour mettre à jour l'affichage des disciplines
        function updateDisciplines() {
            const container = document.getElementById('disciplinesContainer');
            
            // Garder l'en-tête
            const header = container.firstElementChild;
            container.innerHTML = '';
            container.appendChild(header);
            
            // Ajouter les disciplines
            disciplines.forEach((discipline, index) => {
                const row = document.createElement('div');
                row.className = 'discipline-row';
                row.innerHTML = `
                    <div class="discipline-name">
                        <input type="text" value="${discipline.nom}" placeholder="Nom de la discipline" 
                               onchange="updateDisciplineName(${index}, this.value)">
                    </div>
                    <div class="discipline-field">
                        <input type="number" value="${discipline.coefficient}" min="1" step="1" 
                               onchange="updateDisciplineCoefficient(${index}, this.value)" class="coefficient-input">
                    </div>
                    <div class="discipline-field">
                        <input type="number" min="0" max="20" step="0.5" 
                               onchange="updateNote('${currentStudentId}', '${discipline.nom}', 'note1', this.value)"
                               class="note-input" data-discipline="${discipline.nom}" data-type="note1">
                    </div>
                    <div class="discipline-field">
                        <input type="number" min="0" max="20" step="0.5" 
                               onchange="updateNote('${currentStudentId}', '${discipline.nom}', 'note2', this.value)"
                               class="note-input" data-discipline="${discipline.nom}" data-type="note2">
                    </div>
                    <div class="discipline-field">
                        <span class="discipline-average">-</span>
                    </div>
                    <div class="discipline-field">
                        <input type="text" placeholder="Nom enseignant">
                    </div>
                    <div>
                        <button type="button" class="remove-btn" onclick="removeDiscipline(${index})">×</button>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        // Fonction pour mettre à jour le nom d'une discipline
        function updateDisciplineName(index, newName) {
            if (index >= 0 && index < disciplines.length) {
                disciplines[index].nom = newName;
                updateStudentGrades();
            }
        }

        // Fonction pour mettre à jour le coefficient d'une discipline
        function updateDisciplineCoefficient(index, newCoefficient) {
            if (index >= 0 && index < disciplines.length) {
                disciplines[index].coefficient = parseFloat(newCoefficient) || 1;
                calculateAll();
            }
        }

        // Fonction pour supprimer une discipline
        function removeDiscipline(index) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette discipline ?')) {
                disciplines.splice(index, 1);
                updateDisciplines();
                updateStudentGrades();
                calculateAll();
            }
        }

        // Fonction pour mettre à jour une note
        function updateNote(studentId, discipline, type, value) {
            if (!studentId) return;
            
            if (!notes[studentId]) notes[studentId] = {};
            if (!notes[studentId][discipline]) notes[studentId][discipline] = {};
            
            notes[studentId][discipline][type] = value;
            
            // Calculer la moyenne de l'élève
            calculateStudentAverage(studentId);
            
            // Recalculer le classement et les résultats de la classe
            calculateRanking();
            calculateClassResults();
        }

        // Fonction pour mettre à jour les notes des élèves
        function updateStudentGrades() {
            const container = document.getElementById('studentGradesContainer');
            container.innerHTML = '';
            
            // Créer le tableau des notes
            const table = document.createElement('table');
            table.className = 'results-table';
            
            // En-tête du tableau
            let headerHTML = `
                <thead>
                    <tr>
                        <th rowspan="2">Nom et Prénom</th>
                        <th colspan="3">Disciplines</th>
                        <th rowspan="2">Moyenne</th>
                        <th rowspan="2">Rang</th>
                    </tr>
                    <tr>
            `;
            
            disciplines.forEach(discipline => {
                headerHTML += `<th>${discipline.nom} (coef. ${discipline.coefficient})</th>`;
            });
            
            headerHTML += '</tr></thead>';
            
            table.innerHTML = headerHTML;
            
            // Corps du tableau
            const tbody = document.createElement('tbody');
            
            eleves.forEach(eleve => {
                const tr = document.createElement('tr');
                
                // Colonne Nom et Prénom
                let rowHTML = `<td>${eleve.nom} ${eleve.prenom}</td>`;
                
                // Colonnes des disciplines
                disciplines.forEach(discipline => {
                    rowHTML += `
                        <td class="subject-notes">
                            <input type="number" min="0" max="20" step="0.5" 
                                   class="note-input" 
                                   data-student-id="${eleve.id}" 
                                   data-discipline="${discipline.nom}" 
                                   data-type="note1"
                                   value="${notes[eleve.id] && notes[eleve.id][discipline.nom] ? notes[eleve.id][discipline.nom].note1 || '' : ''}"
                                   placeholder="Note 1">
                            <input type="number" min="0" max="20" step="0.5" 
                                   class="note-input" 
                                   data-student-id="${eleve.id}" 
                                   data-discipline="${discipline.nom}" 
                                   data-type="note2"
                                   value="${notes[eleve.id] && notes[eleve.id][discipline.nom] ? notes[eleve.id][discipline.nom].note2 || '' : ''}"
                                   placeholder="Note 2">
                            <span class="subject-average">
                                ${notes[eleve.id] && notes[eleve.id][discipline.nom] ? 
                                  ((parseFloat(notes[eleve.id][discipline.nom].note1 || 0) + parseFloat(notes[eleve.id][discipline.nom].note2 || 0)) / 2).toFixed(2) : '-'}
                            </span>
                        </td>
                    `;
                });
                
                // Colonne Moyenne
                rowHTML += `
                    <td class="highlight student-total-average" data-student-id="${eleve.id}">
                        ${notes[eleve.id]?.moyenneGenerale ? notes[eleve.id].moyenneGenerale.toFixed(2) : '-'}
                    </td>
                `;
                
                // Colonne Rang
                const eleveClassement = classement.find(e => e.id === eleve.id);
                rowHTML += `
                    <td class="rank-cell">
                        ${eleveClassement ? eleveClassement.rang : '-'}
                    </td>
                `;
                
                tr.innerHTML = rowHTML;
                tbody.appendChild(tr);
            });
            
            table.appendChild(tbody);
            container.appendChild(table);
        }

        // Fonction pour générer le bulletin
        function genererBulletin() {
            const bulletinPreview = document.getElementById('bulletinPreview');
            const anneeScolaire = document.getElementById('anneeScolaire').value;
            const periode = document.getElementById('periode').value;
            const etablissement = document.getElementById('etablissement').value;
            const codeEtablissement = document.getElementById('codeEtablissement').value;
            const dateEdition = document.getElementById('dateEdition').value;
            
            // Obtenir l'élève sélectionné pour le bulletin (premier de la liste par défaut)
            let eleve = eleves.length > 0 ? eleves[0] : null;
            
            if (!eleve) {
                bulletinPreview.innerHTML = '<p>Aucun élève trouvé. Veuillez ajouter des élèves d\'abord.</p>';
                return;
            }
            
            // Générer le bulletin
            bulletinPreview.innerHTML = `
                <div class="header">
                    <div class="republic">RÉPUBLIQUE TOGOLAISE</div>
                    <div class="motto">Travail - Liberté - Patrie</div>
                    <div class="ministry">Ministère des Enseignements Primaire, Secondaire et Technique</div>
                    <div class="direction">Direction Régionale de l'Éducation - Kara</div>
                    <div class="title">BULLETIN SCOLAIRE</div>
                    <div class="school-year">Année Scolaire: ${anneeScolaire} - ${getPeriodeText(periode)}</div>
                </div>
                
                <div class="school-info">
                    <div>
                        <div class="info-item"><span class="info-label">Établissement:</span> ${etablissement}</div>
                        <div class="info-item"><span class="info-label">Code:</span> ${codeEtablissement}</div>
                        <div class="info-item"><span class="info-label">Statut:</span> ${document.getElementById('statut').value}</div>
                    </div>
                    <div>
                        <div class="info-item"><span class="info-label">Classe:</span> ${document.getElementById('classe').value}</div>
                        <div class="info-item"><span class="info-label">Effectif:</span> ${eleves.length}</div>
                        <div class="info-item"><span class="info-label">Date d'édition:</span> ${new Date(dateEdition).toLocaleDateString('fr-FR')}</div>
                    </div>
                </div>
                
                <div class="student-info">
                    <div>
                        <div class="info-item"><span class="info-label">Nom et Prénom:</span> ${eleve.nom} ${eleve.prenom}</div>
                        <div class="info-item"><span class="info-label">Matricule:</span> ${eleve.matricule || 'Non précisé'}</div>
                        <div class="info-item"><span class="info-label">Sexe:</span> ${eleve.sexe === 'M' ? 'Masculin' : 'Féminin'}</div>
                    </div>
                    <div>
                        <div class="info-item"><span class="info-label">Né(e) le:</span> ${eleve.dateNaissance ? new Date(eleve.dateNaissance).toLocaleDateString('fr-FR') : 'Non précisé'}</div>
                        <div class="info-item"><span class="info-label">À:</span> ${eleve.lieuNaissance || 'Non précisé'}</div>
                        <div class="info-item"><span class="info-label">Statut:</span> ${eleve.statutEleve === 'Nouveau' ? 'Nouveau/Nouvelle' : 'Redoublant(e)'}</div>
                    </div>
                    <div>
                        <div class="info-item"><span class="info-label">Rang:</span> ${classement.find(e => e.id === eleve.id)?.rang || '-'}</div>
                        <div class="info-item"><span class="info-label">Moyenne:</span> ${notes[eleve.id]?.moyenneGenerale?.toFixed(2) || '0.00'}</div>
                        <div class="info-item"><span class="info-label">Mention:</span> ${getMention(notes[eleve.id]?.moyenneGenerale || 0)}</div>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>DISCIPLINES</th>
                            <th>Coeff.</th>
                            <th>Note 1</th>
                            <th>Note 2</th>
                            <th>Moyenne</th>
                            <th>Appréciation</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${disciplines.map(discipline => {
                            const noteData = notes[eleve.id] && notes[eleve.id][discipline.nom];
                            const note1 = noteData ? parseFloat(noteData.note1) || 0 : 0;
                            const note2 = noteData ? parseFloat(noteData.note2) || 0 : 0;
                            const moyenne = (note1 + note2) / 2;
                            
                            return `
                                <tr>
                                    <td class="discipline-name">${discipline.nom}</td>
                                    <td>${discipline.coefficient}</td>
                                    <td>${note1 > 0 ? note1.toFixed(2) : '-'}</td>
                                    <td>${note2 > 0 ? note2.toFixed(2) : '-'}</td>
                                    <td>${moyenne > 0 ? moyenne.toFixed(2) : '-'}</td>
                                    <td>${getAppreciation(moyenne)}</td>
                                </tr>
                            `;
                        }).join('')}
                        <tr class="summary">
                            <td colspan="4">MOYENNE GÉNÉRALE</td>
                            <td>${notes[eleve.id]?.moyenneGenerale?.toFixed(2) || '0.00'}</td>
                            <td>${getMention(notes[eleve.id]?.moyenneGenerale || 0)}</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="bilan">
                    <div class="bilan-section">
                        <div class="bilan-title">BILAN PÉDAGOGIQUE</div>
                        <div class="info-item"><span class="info-label">Moyenne min. de la classe:</span> ${document.getElementById('moyenneMin').textContent}</div>
                        <div class="info-item"><span class="info-label">Moyenne max. de la classe:</span> ${document.getElementById('moyenneMax').textContent}</div>
                        <div class="info-item"><span class="info-label">Moyenne de la classe:</span> ${document.getElementById('moyenneClasse').textContent}</div>
                    </div>
                    
                    <div class="bilan-section">
                        <div class="bilan-title">ABSENCES</div>
                        <div class="info-item"><span class="info-label">Total d'heures d'absences:</span> ${document.getElementById('totalAbsences').value}</div>
                        <div class="info-item"><span class="info-label">Heures justifiées:</span> ${document.getElementById('justifiedAbsences').value}</div>
                        <div class="info-item"><span class="info-label">Heures non justifiées:</span> ${document.getElementById('unjustifiedAbsences').value}</div>
                    </div>
                    
                    <div class="bilan-section">
                        <div class="bilan-title">DÉCISION DU CONSEIL DE CLASSE</div>
                        <div class="checkbox-item"><div class="checkbox"></div> Admis(e)</div>
                        <div class="checkbox-item"><div class="checkbox"></div> Ajourné(e)</div>
                        <div class="checkbox-item"><div class="checkbox"></div> Redouble</div>
                    </div>
                </div>
                
                <div class="appreciation">
                    <div class="appreciation-title">APPRÉCIATION GÉNÉRALE</div>
                    <div>${getAppreciation(notes[eleve.id]?.moyenneGenerale || 0)}</div>
                </div>
                
                <div class="signatures">
                    <div class="signature">
                        <div>Le Directeur</div>
                        <div class="signature-line"></div>
                    </div>
                    <div class="signature">
                        <div>Le Professeur Principal</div>
                        <div class="signature-line"></div>
                    </div>
                </div>
                
                <div class="footer">
                    Ce bulletin est établi conformément aux textes en vigueur et doit être conservé pour toute réclamation.
                </div>
            `;
        }

        // Fonction pour obtenir le texte de la période
        function getPeriodeText(periode) {
            switch(periode) {
                case '1': return '1er Trimestre';
                case '2': return '2ème Trimestre';
                case '3': return '3ème Trimestre';
                case '4': return '1er Semestre';
                case '5': return '2ème Semestre';
                default: return 'Période non spécifiée';
            }
        }

        // Fonction pour obtenir l'appréciation
        function getAppreciation(note) {
            if (note >= 18) return 'Excellent';
            if (note >= 16) return 'Très Bien';
            if (note >= 14) return 'Bien';
            if (note >= 12) return 'Assez Bien';
            if (note >= 10) return 'Passable';
            return 'Insuffisant';
        }

        // Fonction pour imprimer le bulletin
        function printBulletin() {
            window.print();
        }

        // Fonction pour changer d'onglet
        function switchTab(tabIndex) {
            // Masquer tous les onglets
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Désactiver tous les onglets
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(tab => tab.classList.remove('active'));
            
            // Activer l'onglet sélectionné
            if (tabs[tabIndex]) {
                tabs[tabIndex].classList.add('active');
                tabButtons[tabIndex].classList.add('active');
            }
            
            // Si on passe à l'onglet des résultats, recalculer
            if (tabIndex === 3) {
                calculateAll();
            }
            
            // Si on passe à l'onglet du bulletin, générer l'aperçu
            if (tabIndex === 4) {
                genererBulletin();
            }
            
            // Si on passe à l'onglet des bulletins enregistrés, les afficher
            if (tabIndex === 5) {
                displaySavedBulletins();
            }
            
            // Si on passe au nouvel onglet de tous les bulletins, les charger
            if (tabIndex === 6) {
                loadAllBulletins();
            }
        }

        // Fonction pour charger tous les bulletins
        function loadAllBulletins() {
            const allBulletinsContainer = document.getElementById('allBulletinsContainer');
            allBulletinsContainer.innerHTML = '<p>Chargement des bulletins...</p>';
            
            // Récupérer tous les bulletins sauvegardés
            const savedBulletins = JSON.parse(localStorage.getItem('savedBulletins') || '[]');
            
            if (savedBulletins.length === 0) {
                allBulletinsContainer.innerHTML = '<p>Aucun bulletin enregistré.</p>';
                return;
            }
            
            // Mettre à jour les filtres d'année scolaire
            updateYearFilter(savedBulletins);
            
            // Appliquer les filtres
            const classeFilter = document.getElementById('allFilterClasse').value;
            const periodeFilter = document.getElementById('allFilterPeriode').value;
            const anneeFilter = document.getElementById('allFilterAnnee').value;
            
            const filteredBulletins = savedBulletins.filter(bulletin => {
                if (classeFilter !== 'all' && bulletin.classe !== classeFilter) return false;
                if (periodeFilter !== 'all' && bulletin.periode !== periodeFilter) return false;
                if (anneeFilter !== 'all' && bulletin.anneeScolaire !== anneeFilter) return false;
                return true;
            });
            
            // Afficher les bulletins
            displayAllBulletins(filteredBulletins);
        }

        // Fonction pour afficher tous les bulletins
        function displayAllBulletins(bulletins) {
            const allBulletinsContainer = document.getElementById('allBulletinsContainer');
            allBulletinsContainer.innerHTML = '';
            
            if (bulletins.length === 0) {
                allBulletinsContainer.innerHTML = '<p>Aucun bulletin ne correspond aux filtres.</p>';
                return;
            }
            
            bulletins.forEach(bulletin => {
                const bulletinCard = document.createElement('div');
                bulletinCard.className = 'bulletin-card';
                
                // Calculer les statistiques du bulletin
                const stats = calculateBulletinStats(bulletin);
                
                bulletinCard.innerHTML = `
                    <div class="bulletin-header">
                        <div class="bulletin-title">${bulletin.etablissement} - ${bulletin.classe}</div>
                        <div class="bulletin-details">
                            ${getPeriodeText(bulletin.periode)} ${bulletin.anneeScolaire}
                        </div>
                    </div>
                    <div class="bulletin-stats">
                        <div class="stat">
                            <div class="stat-value">${bulletin.eleves.length}</div>
                            <div class="stat-label">Élèves</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${stats.moyenneClasse.toFixed(2)}</div>
                            <div class="stat-label">Moy. classe</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${stats.admisCount}</div>
                            <div class="stat-label">Admis</div>
                        </div>
                    </div>
                    <div class="bulletin-actions">
                        <button type="button" class="btn btn-sm btn-info" onclick="viewBulletinDetails(${bulletin.id})">
                            <i class="fas fa-list"></i> Détails
                        </button>
                        <button type="button" class="btn btn-sm btn-success" onclick="printBulletinById(${bulletin.id})">
                            <i class="fas fa-print"></i> Imprimer
                        </button>
                    </div>
                `;
                
                allBulletinsContainer.appendChild(bulletinCard);
            });
        }

        // Fonction pour calculer les statistiques d'un bulletin
        function calculateBulletinStats(bulletin) {
            let totalMoyenne = 0;
            let admisCount = 0;
            
            bulletin.eleves.forEach(eleve => {
                totalMoyenne += eleve.moyenne || 0;
                if (eleve.moyenne >= 10) {
                    admisCount++;
                }
            });
            
            const moyenneClasse = bulletin.eleves.length > 0 ? totalMoyenne / bulletin.eleves.length : 0;
            
            return {
                moyenneClasse: moyenneClasse,
                admisCount: admisCount
            };
        }

        // Fonction pour afficher les détails d'un bulletin
        function viewBulletinDetails(bulletinId) {
            const savedBulletins = JSON.parse(localStorage.getItem('savedBulletins') || '[]');
            const bulletin = savedBulletins.find(b => b.id === bulletinId);
            
            if (!bulletin) {
                alert('Bulletin non trouvé!');
                return;
            }
            
            // Créer un modal pour afficher les détails
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2>Détails du Bulletin - ${bulletin.classe} - ${getPeriodeText(bulletin.periode)} ${bulletin.anneeScolaire}</h2>
                        <span class="close" onclick="this.parentElement.parentElement.style.display='none'">&times;</span>
                    </div>
                    <div style="max-height: 60vh; overflow-y: auto;">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Rang</th>
                                    <th>Nom et Prénom</th>
                                    <th>Matricule</th>
                                    <th>Moyenne</th>
                                    <th>Mention</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${bulletin.eleves.sort((a, b) => (a.rang || 0) - (b.rang || 0)).map(eleve => `
                                    <tr>
                                        <td>${eleve.rang || '-'}</td>
                                        <td>${eleve.nom} ${eleve.prenom}</td>
                                        <td>${eleve.matricule || '-'}</td>
                                        <td>${eleve.moyenne ? eleve.moyenne.toFixed(2) : '-'}</td>
                                        <td>${getMention(eleve.moyenne || 0)}</td>
                                        <td>${(eleve.moyenne || 0) >= 10 ? 'Admis' : 'Ajourné'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button type="button" class="btn" onclick="this.parentElement.parentElement.style.display='none'">
                            <i class="fas fa-times"></i> Fermer
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Fermer le modal en cliquant à l'extérieur
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    document.body.removeChild(modal);
                }
            });
        }

        // Fonction pour mettre à jour le filtre des années
        function updateYearFilter(bulletins) {
            const yearFilter = document.getElementById('allFilterAnnee');
            const existingYears = new Set();
            
            // Récupérer toutes les années scolaires uniques
            bulletins.forEach(bulletin => {
                if (bulletin.anneeScolaire) {
                    existingYears.add(bulletin.anneeScolaire);
                }
            });
            
            // Sauvegarder la valeur actuelle
            const currentValue = yearFilter.value;
            
            // Mettre à jour les options
            yearFilter.innerHTML = '<option value="all">Toutes les années</option>';
            
            existingYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
            
            // Restaurer la valeur précédente si elle existe toujours
            if (currentValue && Array.from(yearFilter.options).some(opt => opt.value === currentValue)) {
                yearFilter.value = currentValue;
            }
        }

        // Fonction pour filtrer tous les bulletins
        function filterAllBulletins() {
            loadAllBulletins();
        }

        // Fonction pour effacer tous les filtres
        function clearAllFilters() {
            document.getElementById('allFilterClasse').value = 'all';
            document.getElementById('allFilterPeriode').value = 'all';
            document.getElementById('allFilterAnnee').value = 'all';
            loadAllBulletins();
        }
    </script>
</body>
</html>
